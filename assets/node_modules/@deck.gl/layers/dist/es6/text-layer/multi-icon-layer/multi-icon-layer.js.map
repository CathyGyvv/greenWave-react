{"version":3,"sources":["../../../../src/text-layer/multi-icon-layer/multi-icon-layer.js"],"names":["IconLayer","vs","defaultProps","getShiftInQueue","x","shift","getLengthOfQueue","len","getAnchorX","anchorX","getAnchorY","anchorY","getPixelOffset","pixelOffset","MultiIconLayer","getShaders","Object","assign","initializeState","attributeManager","getAttributeManager","addInstanced","instancePixelOffset","size","transition","accessor","updateState","updateParams","changeFlags","updateTriggersChanged","invalidate","calculateInstanceOffsets","attribute","props","data","iconMapping","getIcon","value","i","object","icon","rect","shiftX","width","height","layerName"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,OAAOA,SAAP,MAAsB,6BAAtB;AAEA,OAAOC,EAAP,MAAe,gCAAf;AAEA,MAAMC,eAAe;AACnBC,mBAAiBC,KAAKA,EAAEC,KAAF,IAAW,CADd;AAEnBC,oBAAkBF,KAAKA,EAAEG,GAAF,IAAS,CAFb;AAGnB;AACAC,cAAYJ,KAAKA,EAAEK,OAAF,IAAa,CAJX;AAKnB;AACAC,cAAYN,KAAKA,EAAEO,OAAF,IAAa,CANX;AAOnBC,kBAAgBR,KAAKA,EAAES,WAAF,IAAiB,CAAC,CAAD,EAAI,CAAJ;AAPnB,CAArB;AAUA,eAAe,MAAMC,cAAN,SAA6Bd,SAA7B,CAAuC;AACpDe,eAAa;AACX,WAAOC,OAAOC,MAAP,CAAc,EAAd,EAAkB,MAAMF,UAAN,EAAlB,EAAsC;AAC3Cd;AAD2C,KAAtC,CAAP;AAGD;;AAEDiB,oBAAkB;AAChB,UAAMA,eAAN;AAEA,UAAMC,mBAAmB,KAAKC,mBAAL,EAAzB;AACAD,qBAAiBE,YAAjB,CAA8B;AAC5BC,2BAAqB;AACnBC,cAAM,CADa;AAEnBC,oBAAY,IAFO;AAGnBC,kBAAU;AAHS;AADO,KAA9B;AAOD;;AAEDC,cAAYC,YAAZ,EAA0B;AACxB,UAAMD,WAAN,CAAkBC,YAAlB;AADwB,UAEjBC,WAFiB,GAEFD,YAFE,CAEjBC,WAFiB;;AAIxB,QACEA,YAAYC,qBAAZ,KACCD,YAAYC,qBAAZ,CAAkCrB,UAAlC,IAAgDoB,YAAYC,qBAAZ,CAAkCnB,UADnF,CADF,EAGE;AACA,WAAKU,mBAAL,GAA2BU,UAA3B,CAAsC,iBAAtC;AACD;AACF;;AAEDC,2BAAyBC,SAAzB,EAAoC;AAAA,wBAS9B,KAAKC,KATyB;AAAA,UAEhCC,IAFgC,eAEhCA,IAFgC;AAAA,UAGhCC,WAHgC,eAGhCA,WAHgC;AAAA,UAIhCC,OAJgC,eAIhCA,OAJgC;AAAA,UAKhC5B,UALgC,eAKhCA,UALgC;AAAA,UAMhCE,UANgC,eAMhCA,UANgC;AAAA,UAOhCJ,gBAPgC,eAOhCA,gBAPgC;AAAA,UAQhCH,eARgC,eAQhCA,eARgC;AAAA,UAU3BkC,KAV2B,GAUlBL,SAVkB,CAU3BK,KAV2B;AAWlC,QAAIC,IAAI,CAAR;;AACA,SAAK,MAAMC,MAAX,IAAqBL,IAArB,EAA2B;AACzB,YAAMM,OAAOJ,QAAQG,MAAR,CAAb;AACA,YAAME,OAAON,YAAYK,IAAZ,KAAqB,EAAlC;AACA,YAAMjC,MAAMD,iBAAiBiC,MAAjB,CAAZ;AACA,YAAMG,SAASvC,gBAAgBoC,MAAhB,CAAf;AAEAF,YAAMC,GAAN,IAAa,CAAC9B,WAAW+B,MAAX,IAAqB,CAAtB,IAA2BhC,GAA3B,GAAiC,CAAjC,GAAqCkC,KAAKE,KAAL,GAAa,CAAlD,GAAsDD,MAAtD,IAAgE,CAA7E;AACAL,YAAMC,GAAN,IAAaG,KAAKG,MAAL,GAAc,CAAd,GAAkBlC,WAAW6B,MAAX,CAAlB,IAAwC,CAArD;AACD;AACF;;AArDmD;AAwDtDzB,eAAe+B,SAAf,GAA2B,gBAA3B;AACA/B,eAAeZ,YAAf,GAA8BA,YAA9B","sourcesContent":["// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport IconLayer from '../../icon-layer/icon-layer';\n\nimport vs from './multi-icon-layer-vertex.glsl';\n\nconst defaultProps = {\n  getShiftInQueue: x => x.shift || 0,\n  getLengthOfQueue: x => x.len || 1,\n  // 1: left, 0: middle, -1: right\n  getAnchorX: x => x.anchorX || 0,\n  // 1: top, 0: center, -1: bottom\n  getAnchorY: x => x.anchorY || 0,\n  getPixelOffset: x => x.pixelOffset || [0, 0]\n};\n\nexport default class MultiIconLayer extends IconLayer {\n  getShaders() {\n    return Object.assign({}, super.getShaders(), {\n      vs\n    });\n  }\n\n  initializeState() {\n    super.initializeState();\n\n    const attributeManager = this.getAttributeManager();\n    attributeManager.addInstanced({\n      instancePixelOffset: {\n        size: 2,\n        transition: true,\n        accessor: 'getPixelOffset'\n      }\n    });\n  }\n\n  updateState(updateParams) {\n    super.updateState(updateParams);\n    const {changeFlags} = updateParams;\n\n    if (\n      changeFlags.updateTriggersChanged &&\n      (changeFlags.updateTriggersChanged.getAnchorX || changeFlags.updateTriggersChanged.getAnchorY)\n    ) {\n      this.getAttributeManager().invalidate('instanceOffsets');\n    }\n  }\n\n  calculateInstanceOffsets(attribute) {\n    const {\n      data,\n      iconMapping,\n      getIcon,\n      getAnchorX,\n      getAnchorY,\n      getLengthOfQueue,\n      getShiftInQueue\n    } = this.props;\n    const {value} = attribute;\n    let i = 0;\n    for (const object of data) {\n      const icon = getIcon(object);\n      const rect = iconMapping[icon] || {};\n      const len = getLengthOfQueue(object);\n      const shiftX = getShiftInQueue(object);\n\n      value[i++] = (getAnchorX(object) - 1) * len / 2 + rect.width / 2 + shiftX || 0;\n      value[i++] = rect.height / 2 * getAnchorY(object) || 0;\n    }\n  }\n}\n\nMultiIconLayer.layerName = 'MultiIconLayer';\nMultiIconLayer.defaultProps = defaultProps;\n"],"file":"multi-icon-layer.js"}