'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _createClass=function(){function defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)descriptor=props[i],descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,'value'in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_browserDriver=require('./browser-driver'),_browserDriver2=_interopRequireDefault(_browserDriver),_color=require('../../lib/utils/color'),_log=require('../../lib/log'),_log2=_interopRequireDefault(_log);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return call&&('object'==typeof call||'function'==typeof call)?call:self}function _inherits(subClass,superClass){if('function'!=typeof superClass&&null!==superClass)throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var log=new _log2.default({id:'render-test'}),webpackEnv='render';3<=process.argv.length&&(webpackEnv=process.argv[2]);var DEFAULT_CONFIG={title:'BrowserTest',exposeFunction:'taskComplete',parameters:['--env.'+webpackEnv]},BrowserTestDriver=function(_BrowserDriver){function BrowserTestDriver(){return _classCallCheck(this,BrowserTestDriver),_possibleConstructorReturn(this,(BrowserTestDriver.__proto__||Object.getPrototypeOf(BrowserTestDriver)).apply(this,arguments))}return _inherits(BrowserTestDriver,_BrowserDriver),_createClass(BrowserTestDriver,[{key:'run',value:function run(){var _this2=this,config=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};config=Object.assign(DEFAULT_CONFIG,config);var _config=config,title=_config.title,exposeFunction=_config.exposeFunction;return this.title=title,log.log({message:title+' started. Launching Chromium instance, waiting for '+exposeFunction+'...',color:_color.COLOR.YELLOW})(),this.time=Date.now(),Promise.resolve().then(function(){return _this2.startServer(config)}).then(function(){return _this2.startBrowser()}).then(function(){return _this2.newPage()}).then(function(){return _this2.exposeFunction(exposeFunction)}).then(function(resultString){var result=JSON.parse(resultString),ok=result.success===!!result.success&&(!result.failedTest||'string'==typeof result.failedTest);if(!ok)throw new Error('Illegal response "'+resultString+'" returned from Chrome test script');if(!result.success)throw new Error(result.failedTest||'Unknown failure');_this2._success()}).catch(function(error){_this2._failure(error)})}},{key:'_success',value:function _success(){var elapsed=((Date.now()-this.time)/1e3).toFixed(1);log.log({message:this.title+' successfully completed in '+elapsed+'s!',color:_color.COLOR.BRIGHT_GREEN})(),this.setShellStatus(!0),this.exit()}},{key:'_failure',value:function _failure(error){log.log({message:this.title+' failed: '+error.message+'. Keeping browser open to allow debugging.',color:_color.COLOR.BRIGHT_RED})(),this.setShellStatus(!1)}}]),BrowserTestDriver}(_browserDriver2.default);exports.default=BrowserTestDriver;
//# sourceMappingURL=browser-test-driver.js.map