!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).supercluster=t()}}(function(){return function r(s,u,a){function h(n,t){if(!u[n]){if(!s[n]){var o="function"==typeof require&&require;if(!t&&o)return o(n,!0);if(p)return p(n,!0);var e=new Error("Cannot find module '"+n+"'");throw e.code="MODULE_NOT_FOUND",e}var i=u[n]={exports:{}};s[n][0].call(i.exports,function(t){var o=s[n][1][t];return h(o||t)},i,i.exports,r,s,u,a)}return u[n].exports}for(var p="function"==typeof require&&require,t=0;t<a.length;t++)h(a[t]);return h}({1:[function(t,o,n){"use strict";var p=t("kdbush");function e(t){return new i(t)}function i(t){this.options=r(Object.create(this.options),t),this.trees=new Array(this.options.maxZoom+1)}function d(t){return{type:"Feature",properties:a(t),geometry:{type:"Point",coordinates:[(e=t.x,360*(e-.5)),(o=t.y,n=(180-360*o)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var o,n,e}function a(t){var o=t.numPoints,n=1e4<=o?Math.round(o/1e3)+"k":1e3<=o?Math.round(o/100)/10+"k":o;return r(r({},t.properties),{cluster:!0,cluster_id:t.id,point_count:o,point_count_abbreviated:n})}function l(t){return t/360+.5}function m(t){var o=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+o)/(1-o))/Math.PI;return n<0?0:1<n?1:n}function r(t,o){for(var n in o)t[n]=o[n];return t}function f(t){return t.x}function c(t){return t.y}o.exports=e,o.exports.default=e,i.prototype={options:{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,initial:function(){return{}},map:function(t){return t}},load:function(t){var o=this.options.log;o&&console.time("total time");var n="prepare "+t.length+" points";o&&console.time(n),this.points=t;for(var e,i,r,s=[],u=0;u<t.length;u++)t[u].geometry&&s.push((e=t[u],i=u,void 0,{x:l((r=e.geometry.coordinates)[0]),y:m(r[1]),zoom:1/0,id:i,parentId:-1}));this.trees[this.options.maxZoom+1]=p(s,f,c,this.options.nodeSize,Float32Array),o&&console.timeEnd(n);for(var a=this.options.maxZoom;a>=this.options.minZoom;a--){var h=+Date.now();s=this._cluster(s,a),this.trees[a]=p(s,f,c,this.options.nodeSize,Float32Array),o&&console.log("z%d: %d clusters in %dms",a,s.length,+Date.now()-h)}return o&&console.timeEnd("total time"),this},getClusters:function(t,o){var n=((t[0]+180)%360+360)%360-180,e=Math.max(-90,Math.min(90,t[1])),i=((t[2]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,t[3]));if(t[0]>t[2]){var s=this.getClusters([n,e,180,r],o),u=this.getClusters([-180,e,i,r],o);return s.concat(u)}for(var a=this.trees[this._limitZoom(o)],h=a.range(l(n),m(r),l(i),m(e)),p=[],f=0;f<h.length;f++){var c=a.points[h[f]];p.push(c.numPoints?d(c):this.points[c.id])}return p},getChildren:function(t){var o=t>>5,n=t%32,e="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(e);var r=i.points[o];if(!r)throw new Error(e);for(var s=this.options.radius/(this.options.extent*Math.pow(2,n-1)),u=i.within(r.x,r.y,s),a=[],h=0;h<u.length;h++){var p=i.points[u[h]];p.parentId===t&&a.push(p.numPoints?d(p):this.points[p.id])}if(0===a.length)throw new Error(e);return a},getLeaves:function(t,o,n){o=o||10,n=n||0;var e=[];return this._appendLeaves(e,t,o,n,0),e},getTile:function(t,o,n){var e=this.trees[this._limitZoom(t)],i=Math.pow(2,t),r=this.options.extent,s=this.options.radius/r,u=(n-s)/i,a=(n+1+s)/i,h={features:[]};return this._addTileFeatures(e.range((o-s)/i,u,(o+1+s)/i,a),e.points,o,n,i,h),0===o&&this._addTileFeatures(e.range(1-s/i,u,1,a),e.points,i,n,i,h),o===i-1&&this._addTileFeatures(e.range(0,u,s/i,a),e.points,-1,n,i,h),h.features.length?h:null},getClusterExpansionZoom:function(t){for(var o=t%32-1;o<this.options.maxZoom;){var n=this.getChildren(t);if(o++,1!==n.length)break;t=n[0].properties.cluster_id}return o},_appendLeaves:function(t,o,n,e,i){for(var r=this.getChildren(o),s=0;s<r.length;s++){var u=r[s].properties;if(u&&u.cluster?i+u.point_count<=e?i+=u.point_count:i=this._appendLeaves(t,u.cluster_id,n,e,i):i<e?i++:t.push(r[s]),t.length===n)break}return i},_addTileFeatures:function(t,o,n,e,i,r){for(var s=0;s<t.length;s++){var u=o[t[s]];r.features.push({type:1,geometry:[[Math.round(this.options.extent*(u.x*i-n)),Math.round(this.options.extent*(u.y*i-e))]],tags:u.numPoints?a(u):this.points[u.id].properties})}},_limitZoom:function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},_cluster:function(t,o){for(var n=[],e=this.options.radius/(this.options.extent*Math.pow(2,o)),i=0;i<t.length;i++){var r=t[i];if(!(r.zoom<=o)){r.zoom=o;var s=this.trees[o+1],u=s.within(r.x,r.y,e),a=r.numPoints||1,h=r.x*a,p=r.y*a,f=null;this.options.reduce&&(f=this.options.initial(),this._accumulate(f,r));for(var c=(i<<5)+(o+1),d=0;d<u.length;d++){var l=s.points[u[d]];if(!(l.zoom<=o)){l.zoom=o;var m=l.numPoints||1;h+=l.x*m,p+=l.y*m,a+=m,l.parentId=c,this.options.reduce&&this._accumulate(f,l)}}1===a?n.push(r):(r.parentId=c,n.push({x:h/a,y:p/a,zoom:1/0,id:c,parentId:-1,numPoints:a,properties:f}))}}return n},_accumulate:function(t,o){var n=o.numPoints?o.properties:this.options.map(this.points[o.id].properties);this.options.reduce(t,n)}}},{kdbush:2}],2:[function(t,o,n){"use strict";var s=t("./sort"),i=t("./range"),e=t("./within");function r(t,o,n,e,i){o=o||u,n=n||a,i=i||Array,this.nodeSize=e||64,this.points=t,this.ids=new i(t.length),this.coords=new i(2*t.length);for(var r=0;r<t.length;r++)this.ids[r]=r,this.coords[2*r]=o(t[r]),this.coords[2*r+1]=n(t[r]);s(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function u(t){return t[0]}function a(t){return t[1]}o.exports=function(t,o,n,e,i){return new r(t,o,n,e,i)},r.prototype={range:function(t,o,n,e){return i(this.ids,this.coords,t,o,n,e,this.nodeSize)},within:function(t,o,n){return e(this.ids,this.coords,t,o,n,this.nodeSize)}}},{"./range":3,"./sort":4,"./within":5}],3:[function(t,o,n){"use strict";o.exports=function(t,o,n,e,i,r,s){var u,a,h=[0,t.length-1,0],p=[];for(;h.length;){var f=h.pop(),c=h.pop(),d=h.pop();if(c-d<=s)for(var l=d;l<=c;l++)u=o[2*l],a=o[2*l+1],n<=u&&u<=i&&e<=a&&a<=r&&p.push(t[l]);else{var m=Math.floor((d+c)/2);u=o[2*m],a=o[2*m+1],n<=u&&u<=i&&e<=a&&a<=r&&p.push(t[m]);var v=(f+1)%2;(0===f?n<=u:e<=a)&&(h.push(d),h.push(m-1),h.push(v)),(0===f?u<=i:a<=r)&&(h.push(m+1),h.push(c),h.push(v))}}return p}},{}],4:[function(t,o,n){"use strict";function g(t,o,n,e){i(t,n,e),i(o,2*n,2*e),i(o,2*n+1,2*e+1)}function i(t,o,n){var e=t[o];t[o]=t[n],t[n]=e}o.exports=function t(o,n,e,i,r,s){if(r-i<=e)return;var u=Math.floor((i+r)/2);!function t(o,n,e,i,r,s){for(;i<r;){if(600<r-i){var u=r-i+1,a=e-i+1,h=Math.log(u),p=.5*Math.exp(2*h/3),f=.5*Math.sqrt(h*p*(u-p)/u)*(a-u/2<0?-1:1),c=Math.max(i,Math.floor(e-a*p/u+f)),d=Math.min(r,Math.floor(e+(u-a)*p/u+f));t(o,n,e,c,d,s)}var l=n[2*e+s],m=i,v=r;for(g(o,n,i,e),n[2*r+s]>l&&g(o,n,i,r);m<v;){for(g(o,n,m,v),m++,v--;n[2*m+s]<l;)m++;for(;n[2*v+s]>l;)v--}n[2*i+s]===l?g(o,n,i,v):g(o,n,++v,r),v<=e&&(i=v+1),e<=v&&(r=v-1)}}(o,n,u,i,r,s%2);t(o,n,e,i,u-1,s+1);t(o,n,e,u+1,r,s+1)}},{}],5:[function(t,o,n){"use strict";function g(t,o,n,e){var i=t-n,r=o-e;return i*i+r*r}o.exports=function(t,o,n,e,i,r){var s=[0,t.length-1,0],u=[],a=i*i;for(;s.length;){var h=s.pop(),p=s.pop(),f=s.pop();if(p-f<=r)for(var c=f;c<=p;c++)g(o[2*c],o[2*c+1],n,e)<=a&&u.push(t[c]);else{var d=Math.floor((f+p)/2),l=o[2*d],m=o[2*d+1];g(l,m,n,e)<=a&&u.push(t[d]);var v=(h+1)%2;(0===h?n-i<=l:e-i<=m)&&(s.push(f),s.push(d-1),s.push(v)),(0===h?l<=n+i:m<=e+i)&&(s.push(d+1),s.push(p),s.push(v))}}return u}},{}]},{},[1])(1)});
