{"version":3,"sources":["../../src/matrix4.js"],"names":["MathArray","checkNumber","Vector2","Vector3","Vector4","mat4_determinant","mat4_fromQuat","mat4_frustum","mat4_lookAt","mat4_ortho","mat4_perspective","mat4_transpose","mat4_invert","mat4_multiply","mat4_rotate","mat4_scale","mat4_translate","vec2_transformMat4","vec3_transformMat4","vec4_transformMat4","mat4_rotateX","mat4_rotateY","mat4_rotateZ","IDENTITY","validateMatrix4","m","length","Number","isFinite","validateVector","v","every","Matrix4","constructor","args","Array","isArray","arguments","copy","identity","ELEMENTS","setRowMajor","m00","m01","m02","m03","m10","m11","m12","m13","m20","m21","m22","m23","m30","m31","m32","m33","check","setColumnMajor","array","set","getElement","i","j","columnMajor","setElement","value","determinant","fromQuaternion","q","frustum","left","right","bottom","top","near","far","lookAt","eye","center","up","ortho","orthographic","fovy","Math","PI","aspect","focalDistance","Error","halfY","tan","perspective","fov","transpose","invert","multiplyLeft","a","multiplyRight","rotateX","radians","rotateY","rotateZ","rotateXYZ","rx","ry","rz","rotateAxis","axis","scale","vec","translate","transformVector2","vector","out","transformVector3","transformVector4","transformVector","transformDirection","_transformVector","transformPoint","w","Boolean","makeRotationX","makeTranslation","x","y","z"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,OAAOA,SAAP,MAAsB,kBAAtB;AACA,SAAQC,WAAR,QAA0B,cAA1B;AACA,OAAOC,OAAP,MAAoB,WAApB;AACA,OAAOC,OAAP,MAAoB,WAApB;AACA,OAAOC,OAAP,MAAoB,WAApB,C,CAEA;;AACA;;AACA,OAAOC,gBAAP,MAA6B,qBAA7B;AACA,OAAOC,aAAP,MAA0B,kBAA1B;AACA,OAAOC,YAAP,MAAyB,iBAAzB;AACA,OAAOC,WAAP,MAAwB,gBAAxB;AACA,OAAOC,UAAP,MAAuB,eAAvB;AACA,OAAOC,gBAAP,MAA6B,qBAA7B;AACA,OAAOC,cAAP,MAA2B,mBAA3B;AACA,OAAOC,WAAP,MAAwB,gBAAxB;AACA,OAAOC,aAAP,MAA0B,kBAA1B;AACA,OAAOC,WAAP,MAAwB,gBAAxB;AACA,OAAOC,UAAP,MAAuB,eAAvB;AACA,OAAOC,cAAP,MAA2B,mBAA3B;AACA,OAAOC,kBAAP,MAA+B,uBAA/B;AACA,OAAOC,kBAAP,MAA+B,uBAA/B;AACA,OAAOC,kBAAP,MAA+B,uBAA/B;AAEA,OAAOC,YAAP,MAAyB,iBAAzB;AACA,OAAOC,YAAP,MAAyB,iBAAzB;AACA,OAAOC,YAAP,MAAyB,iBAAzB;AAEA,MAAMC,WAAW,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAzB,EAA4B,CAA5B,EAA+B,CAA/B,EAAkC,CAAlC,EAAqC,CAArC,EAAwC,CAAxC,EAA2C,CAA3C,EAA8C,CAA9C,CAAjB;AAEA,OAAO,SAASC,eAAT,CAAyBC,CAAzB,EAA4B;AACjC,SACEA,EAAEC,MAAF,KAAa,EAAb,IACAC,OAAOC,QAAP,CAAgBH,EAAE,CAAF,CAAhB,CADA,IAEAE,OAAOC,QAAP,CAAgBH,EAAE,CAAF,CAAhB,CAFA,IAGAE,OAAOC,QAAP,CAAgBH,EAAE,CAAF,CAAhB,CAHA,IAIAE,OAAOC,QAAP,CAAgBH,EAAE,CAAF,CAAhB,CAJA,IAKAE,OAAOC,QAAP,CAAgBH,EAAE,CAAF,CAAhB,CALA,IAMAE,OAAOC,QAAP,CAAgBH,EAAE,CAAF,CAAhB,CANA,IAOAE,OAAOC,QAAP,CAAgBH,EAAE,CAAF,CAAhB,CAPA,IAQAE,OAAOC,QAAP,CAAgBH,EAAE,CAAF,CAAhB,CARA,IASAE,OAAOC,QAAP,CAAgBH,EAAE,CAAF,CAAhB,CATA,IAUAE,OAAOC,QAAP,CAAgBH,EAAE,CAAF,CAAhB,CAVA,IAWAE,OAAOC,QAAP,CAAgBH,EAAE,EAAF,CAAhB,CAXA,IAYAE,OAAOC,QAAP,CAAgBH,EAAE,EAAF,CAAhB,CAZA,IAaAE,OAAOC,QAAP,CAAgBH,EAAE,EAAF,CAAhB,CAbA,IAcAE,OAAOC,QAAP,CAAgBH,EAAE,EAAF,CAAhB,CAdA,IAeAE,OAAOC,QAAP,CAAgBH,EAAE,EAAF,CAAhB,CAfA,IAgBAE,OAAOC,QAAP,CAAgBH,EAAE,EAAF,CAAhB,CAjBF;AAmBD;;AAED,SAASI,cAAT,CAAwBC,CAAxB,EAA2BJ,MAA3B,EAAmC;AACjC,MAAII,EAAEJ,MAAF,KAAaA,MAAjB,EAAyB;AACvB,WAAO,KAAP;AACD;;AACD,SAAOI,EAAEC,KAAF,CAAQJ,OAAOC,QAAf,CAAP;AACD;;AAED,eAAe,MAAMI,OAAN,SAAsBhC,SAAtB,CAAgC;AAC7CiC,cAAY,GAAGC,IAAf,EAAqB;AACnB;;AACA,QAAIC,MAAMC,OAAN,CAAcF,KAAK,CAAL,CAAd,KAA0BG,UAAUX,MAAV,KAAqB,CAAnD,EAAsD;AACpD,WAAKY,IAAL,CAAUJ,KAAK,CAAL,CAAV;AACD,KAFD,MAEO;AACL,WAAKK,QAAL;AACD;AACF;;AAED,MAAIC,QAAJ,GAAe;AACb,WAAO,EAAP;AACD;AAED;AACA;;;AACAC,cACEC,MAAM,CADR,EACWC,MAAM,CADjB,EACoBC,MAAM,CAD1B,EAC6BC,MAAM,CADnC,EAEEC,MAAM,CAFR,EAEWC,MAAM,CAFjB,EAEoBC,MAAM,CAF1B,EAE6BC,MAAM,CAFnC,EAGEC,MAAM,CAHR,EAGWC,MAAM,CAHjB,EAGoBC,MAAM,CAH1B,EAG6BC,MAAM,CAHnC,EAIEC,MAAM,CAJR,EAIWC,MAAM,CAJjB,EAIoBC,MAAM,CAJ1B,EAI6BC,MAAM,CAJnC,EAKE;AACA,SAAK,CAAL,IAAUf,GAAV;AACA,SAAK,CAAL,IAAUI,GAAV;AACA,SAAK,CAAL,IAAUI,GAAV;AACA,SAAK,CAAL,IAAUI,GAAV;AACA,SAAK,CAAL,IAAUX,GAAV;AACA,SAAK,CAAL,IAAUI,GAAV;AACA,SAAK,CAAL,IAAUI,GAAV;AACA,SAAK,CAAL,IAAUI,GAAV;AACA,SAAK,CAAL,IAAUX,GAAV;AACA,SAAK,CAAL,IAAUI,GAAV;AACA,SAAK,EAAL,IAAWI,GAAX;AACA,SAAK,EAAL,IAAWI,GAAX;AACA,SAAK,EAAL,IAAWX,GAAX;AACA,SAAK,EAAL,IAAWI,GAAX;AACA,SAAK,EAAL,IAAWI,GAAX;AACA,SAAK,EAAL,IAAWI,GAAX;AACA,WAAO,KAAKC,KAAL,EAAP;AACD,GAvC4C,CAyC7C;;;AACAC,iBACEjB,MAAM,CADR,EACWI,MAAM,CADjB,EACoBI,MAAM,CAD1B,EAC6BI,MAAM,CADnC,EAEEX,MAAM,CAFR,EAEWI,MAAM,CAFjB,EAEoBI,MAAM,CAF1B,EAE6BI,MAAM,CAFnC,EAGEX,MAAM,CAHR,EAGWI,MAAM,CAHjB,EAGoBI,MAAM,CAH1B,EAG6BI,MAAM,CAHnC,EAIEX,MAAM,CAJR,EAIWI,MAAM,CAJjB,EAIoBI,MAAM,CAJ1B,EAI6BI,MAAM,CAJnC,EAKE;AACA,SAAK,CAAL,IAAUf,GAAV;AACA,SAAK,CAAL,IAAUI,GAAV;AACA,SAAK,CAAL,IAAUI,GAAV;AACA,SAAK,CAAL,IAAUI,GAAV;AACA,SAAK,CAAL,IAAUX,GAAV;AACA,SAAK,CAAL,IAAUI,GAAV;AACA,SAAK,CAAL,IAAUI,GAAV;AACA,SAAK,CAAL,IAAUI,GAAV;AACA,SAAK,CAAL,IAAUX,GAAV;AACA,SAAK,CAAL,IAAUI,GAAV;AACA,SAAK,EAAL,IAAWI,GAAX;AACA,SAAK,EAAL,IAAWI,GAAX;AACA,SAAK,EAAL,IAAWX,GAAX;AACA,SAAK,EAAL,IAAWI,GAAX;AACA,SAAK,EAAL,IAAWI,GAAX;AACA,SAAK,EAAL,IAAWI,GAAX;AACA,WAAO,KAAKC,KAAL,EAAP;AACD;AACD;;;AAEApB,OAAKsB,KAAL,EAAY;AACV,WAAO,KAAKD,cAAL,CAAoB,GAAGC,KAAvB,CAAP;AACD,GAtE4C,CAwE7C;;;AACAC,MAAI,GAAG3B,IAAP,EAAa;AACX,WAAO,KAAKyB,cAAL,CAAoB,GAAGzB,IAAvB,CAAP;AACD,GA3E4C,CA6E7C;;;AACA4B,aAAWC,CAAX,EAAcC,CAAd,EAAiBC,cAAc,KAA/B,EAAsC;AACpC,WAAOA,cAAc,KAAKF,CAAL,EAAQC,CAAR,CAAd,GAA2B,KAAKA,CAAL,EAAQD,CAAR,CAAlC;AACD,GAhF4C,CAkF7C;;;AACAG,aAAWH,CAAX,EAAcC,CAAd,EAAiBG,KAAjB,EAAwBF,cAAc,KAAtC,EAA6C;AAC3C,QAAIA,WAAJ,EAAiB;AACf,WAAKD,CAAL,EAAQD,CAAR,IAAa9D,YAAYkE,KAAZ,CAAb;AACD,KAFD,MAEO;AACL,WAAKH,CAAL,EAAQD,CAAR,IAAa9D,YAAYkE,KAAZ,CAAb;AACD;;AACD,WAAO,IAAP;AACD;AAED;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;AAEAC,gBAAc;AACZ,WAAO/D,iBAAiB,IAAjB,CAAP;AACD,GA1G4C,CA4G7C;;;AAEAkC,aAAW;AACT,WAAO,KAAKD,IAAL,CAAUf,QAAV,CAAP;AACD,GAhH4C,CAkH7C;AACA;;;AACA8C,iBAAeC,CAAf,EAAkB;AAChBhE,kBAAc,IAAd,EAAoBgE,CAApB;AACA,WAAO,KAAKZ,KAAL,EAAP;AACD,GAvH4C,CAyH7C;AACA;AACA;AACA;AACA;AACA;AACA;;;AACAa,UAAQ;AAACC,QAAD;AAAOC,SAAP;AAAcC,UAAd;AAAsBC,OAAtB;AAA2BC,QAA3B;AAAiCC;AAAjC,GAAR,EAA+C;AAC7CtE,iBAAa,IAAb,EAAmBiE,IAAnB,EAAyBC,KAAzB,EAAgCC,MAAhC,EAAwCC,GAAxC,EAA6CC,IAA7C,EAAmDC,GAAnD;AACA,WAAO,KAAKnB,KAAL,EAAP;AACD,GAnI4C,CAqI7C;AACA;AACA;AACA;AACA;;;AACAoB,SAAO;AAACC,OAAD;AAAMC,aAAS,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAf;AAA0BC,SAAK,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP;AAA/B,GAAP,EAAkD;AAChDzE,gBAAY,IAAZ,EAAkBuE,GAAlB,EAAuBC,MAAvB,EAA+BC,EAA/B;AACA,WAAO,KAAKvB,KAAL,EAAP;AACD,GA7I4C,CA+I7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACAwB,QAAM;AAACV,QAAD;AAAOC,SAAP;AAAcC,UAAd;AAAsBC,OAAtB;AAA2BC,WAAO,GAAlC;AAAuCC,UAAM;AAA7C,GAAN,EAAyD;AACvDpE,eAAW,IAAX,EAAiB+D,IAAjB,EAAuBC,KAAvB,EAA8BC,MAA9B,EAAsCC,GAAtC,EAA2CC,IAA3C,EAAiDC,GAAjD;AACA,WAAO,KAAKnB,KAAL,EAAP;AACD,GA1J4C,CA4J7C;AACA;AACA;AACA;AACA;AACA;AACA;;;AACAyB,eAAa;AAACC,WAAO,KAAKC,KAAKC,EAAV,GAAe,GAAvB;AAA4BC,aAAS,CAArC;AAAwCC,oBAAgB,CAAxD;AAA2DZ,WAAO,GAAlE;AAAuEC,UAAM;AAA7E,GAAb,EAAgG;AAC9F,QAAIO,OAAOC,KAAKC,EAAL,GAAU,CAArB,EAAwB;AACtB,YAAMG,MAAM,SAAN,CAAN;AACD;;AACD,UAAMC,QAAQN,OAAO,CAArB;AACA,UAAMT,MAAMa,gBAAgBH,KAAKM,GAAL,CAASD,KAAT,CAA5B,CAL8F,CAKjD;;AAC7C,UAAMjB,QAAQE,MAAMY,MAApB;AAEA,WAAO,IAAIvD,OAAJ,GAAckD,KAAd,CAAoB;AACzBV,YAAM,CAACC,KADkB;AAEzBA,WAFyB;AAGzBC,cAAQ,CAACC,GAHgB;AAIzBA,SAJyB;AAKzBC,UALyB;AAMzBC;AANyB,KAApB,CAAP;AAQD,GAnL4C,CAqL7C;AACA;AACA;AACA;AACA;;;AACAe,cAAY;AACVR,QADU;AAEVS,UAAM,KAAKR,KAAKC,EAAV,GAAe,GAFX;AAEgB;AAC1BC,aAAS,CAHC;AAIVX,WAAO,GAJG;AAKVC,UAAM;AALI,MAMR,EANJ,EAMQ;AACNO,WAAOA,QAAQS,GAAf;;AACA,QAAIT,OAAOC,KAAKC,EAAL,GAAU,CAArB,EAAwB;AACtB,YAAMG,MAAM,SAAN,CAAN;AACD;;AACD/E,qBAAiB,IAAjB,EAAuB0E,IAAvB,EAA6BG,MAA7B,EAAqCX,IAArC,EAA2CC,GAA3C;AACA,WAAO,KAAKnB,KAAL,EAAP;AACD,GAvM4C,CAyM7C;;;AAEAoC,cAAY;AACVnF,mBAAe,IAAf,EAAqB,IAArB;AACA,WAAO,KAAK+C,KAAL,EAAP;AACD;;AAEDqC,WAAS;AACPnF,gBAAY,IAAZ,EAAkB,IAAlB;AACA,WAAO,KAAK8C,KAAL,EAAP;AACD,GAnN4C,CAqN7C;;;AAEAsC,eAAaC,CAAb,EAAgB;AACdpF,kBAAc,IAAd,EAAoBoF,CAApB,EAAuB,IAAvB;AACA,WAAO,KAAKvC,KAAL,EAAP;AACD;;AAEDwC,gBAAcD,CAAd,EAAiB;AACfpF,kBAAc,IAAd,EAAoB,IAApB,EAA0BoF,CAA1B;AACA,WAAO,KAAKvC,KAAL,EAAP;AACD,GA/N4C,CAiO7C;;;AACAyC,UAAQC,OAAR,EAAiB;AACfhF,iBAAa,IAAb,EAAmB,IAAnB,EAAyBgF,OAAzB,EADe,CAEf;;AACA,WAAO,KAAK1C,KAAL,EAAP;AACD,GAtO4C,CAwO7C;;;AACA2C,UAAQD,OAAR,EAAiB;AACf/E,iBAAa,IAAb,EAAmB,IAAnB,EAAyB+E,OAAzB,EADe,CAEf;;AACA,WAAO,KAAK1C,KAAL,EAAP;AACD,GA7O4C,CA+O7C;;;AACA4C,UAAQF,OAAR,EAAiB;AACf9E,iBAAa,IAAb,EAAmB,IAAnB,EAAyB8E,OAAzB,EADe,CAEf;;AACA,WAAO,KAAK1C,KAAL,EAAP;AACD;;AAED6C,YAAU,CAACC,EAAD,EAAKC,EAAL,EAASC,EAAT,CAAV,EAAwB;AACtB,WAAO,KAAKP,OAAL,CAAaK,EAAb,EACJH,OADI,CACII,EADJ,EAEJH,OAFI,CAEII,EAFJ,CAAP;AAGD;;AAEDC,aAAWP,OAAX,EAAoBQ,IAApB,EAA0B;AACxB9F,gBAAY,IAAZ,EAAkB,IAAlB,EAAwBsF,OAAxB,EAAiCQ,IAAjC;AACA,WAAO,KAAKlD,KAAL,EAAP;AACD;;AAEDmD,QAAMC,GAAN,EAAW;AACT/F,eAAW,IAAX,EAAiB,IAAjB,EAAuB+F,GAAvB;AACA,WAAO,KAAKpD,KAAL,EAAP;AACD;;AAEDqD,YAAUD,GAAV,EAAe;AACb9F,mBAAe,IAAf,EAAqB,IAArB,EAA2B8F,GAA3B;AACA,WAAO,KAAKpD,KAAL,EAAP;AACD;;AAEDsD,mBAAiBC,MAAjB,EAAyBC,GAAzB,EAA8B;AAC5B;AACAA,UAAMA,OAAO,IAAIhH,OAAJ,EAAb;AACAe,uBAAmBiG,GAAnB,EAAwBD,MAAxB,EAAgC,IAAhC;AACApF,mBAAeqF,GAAf,EAAoB,CAApB;AACA,WAAOA,GAAP;AACD;;AAEDC,mBAAiBF,MAAjB,EAAyBC,GAAzB,EAA8B;AAC5B;AACAA,UAAMA,OAAO,IAAI/G,OAAJ,EAAb;AACAe,uBAAmBgG,GAAnB,EAAwBD,MAAxB,EAAgC,IAAhC;AACApF,mBAAeqF,GAAf,EAAoB,CAApB;AACA,WAAOA,GAAP;AACD;;AAEDE,mBAAiBH,MAAjB,EAAyBC,GAAzB,EAA8B;AAC5B;AACAA,UAAMA,OAAO,IAAI9G,OAAJ,EAAb;AACAe,uBAAmB+F,GAAnB,EAAwBD,MAAxB,EAAgC,IAAhC;AACApF,mBAAeqF,GAAf,EAAoB,CAApB;AACA,WAAOA,IAAIxD,KAAJ,EAAP;AACD,GAjS4C,CAmS7C;AACA;;;AACA2D,kBAAgBJ,MAAhB,EAAwBC,GAAxB,EAA6B;AAC3B,YAAQD,OAAOvF,MAAf;AACE,WAAK,CAAL;AACE,eAAO,KAAKsF,gBAAL,CAAsBC,MAAtB,EAA8BC,GAA9B,CAAP;;AACF,WAAK,CAAL;AACE,eAAO,KAAKC,gBAAL,CAAsBF,MAAtB,EAA8BC,GAA9B,CAAP;;AACF,WAAK,CAAL;AACE,eAAO,KAAKE,gBAAL,CAAsBH,MAAtB,EAA8BC,GAA9B,CAAP;;AACF;AACE,cAAM,IAAIzB,KAAJ,CAAU,gBAAV,CAAN;AARJ;AAUD;;AAED6B,qBAAmBL,MAAnB,EAA2BC,GAA3B,EAAgC;AAC9B,WAAO,KAAKK,gBAAL,CAAsBN,MAAtB,EAA8BC,GAA9B,EAAmC,CAAnC,CAAP;AACD;;AAEDM,iBAAeP,MAAf,EAAuBC,GAAvB,EAA4B;AAC1B,WAAO,KAAKK,gBAAL,CAAsBN,MAAtB,EAA8BC,GAA9B,EAAmC,CAAnC,CAAP;AACD;;AAEDK,mBAAiBN,MAAjB,EAAyBC,GAAzB,EAA8BO,CAA9B,EAAiC;AAC/B,YAAQR,OAAOvF,MAAf;AACE,WAAK,CAAL;AACEwF,cAAMA,OAAO,IAAIhH,OAAJ,EAAb,CADF,CAEE;;AACAiB,2BAAmB+F,GAAnB,EAAwB,CAACD,OAAO,CAAP,CAAD,EAAYA,OAAO,CAAP,CAAZ,EAAuB,CAAvB,EAA0BQ,CAA1B,CAAxB,EAAsD,IAAtD;AACAP,YAAIxF,MAAJ,GAAa,CAAb;AACAG,uBAAeqF,GAAf,EAAoB,CAApB;AACA;;AACF,WAAK,CAAL;AACEA,cAAMA,OAAO,IAAI/G,OAAJ,EAAb,CADF,CAEE;;AACAgB,2BAAmB+F,GAAnB,EAAwB,CAACD,OAAO,CAAP,CAAD,EAAYA,OAAO,CAAP,CAAZ,EAAuBA,OAAO,CAAP,CAAvB,EAAkCQ,CAAlC,CAAxB,EAA8D,IAA9D;AACAP,YAAIxF,MAAJ,GAAa,CAAb;AACAG,uBAAeqF,GAAf,EAAoB,CAApB;AACA;;AACF,WAAK,CAAL;AACE,YAAIQ,QAAQD,CAAR,MAAeC,QAAQT,OAAO,CAAP,CAAR,CAAnB,EAAuC;AACrC,gBAAM,IAAIxB,KAAJ,CAAU,kDAAV,CAAN;AACD;;AACDyB,cAAMA,OAAO,IAAI9G,OAAJ,EAAb,CAJF,CAKE;;AACAe,2BAAmB+F,GAAnB,EAAwBD,MAAxB,EAAgC,IAAhC;AACApF,uBAAeqF,GAAf,EAAoB,CAApB;AACA;;AACF;AACE,cAAM,IAAIzB,KAAJ,CAAU,gBAAV,CAAN;AAzBJ;;AA2BA,WAAOyB,GAAP;AACD,GAvV4C,CAyV7C;;;AACAS,gBAAcvB,OAAd,EAAuB;AACrB,WAAO,KAAK7D,QAAL,GAAgB4D,OAAhB,CAAwBC,OAAxB,CAAP;AACD;;AAEDwB,kBAAgBC,CAAhB,EAAmBC,CAAnB,EAAsBC,CAAtB,EAAyB;AACvB,WAAO,KAAKxF,QAAL,GAAgBwE,SAAhB,CAA0B,CAACc,CAAD,EAAIC,CAAJ,EAAOC,CAAP,CAA1B,CAAP;AACD;;AAhW4C","sourcesContent":["// Copyright (c) 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport MathArray from './lib/math-array';\nimport {checkNumber} from './lib/common';\nimport Vector2 from './vector2';\nimport Vector3 from './vector3';\nimport Vector4 from './vector4';\n\n// gl-matrix is too big. Cherry-pick individual imports from stack.gl version\n/* eslint-disable camelcase */\nimport mat4_determinant from 'gl-mat4/determinant';\nimport mat4_fromQuat from 'gl-mat4/fromQuat';\nimport mat4_frustum from 'gl-mat4/frustum';\nimport mat4_lookAt from 'gl-mat4/lookAt';\nimport mat4_ortho from 'gl-mat4/ortho';\nimport mat4_perspective from 'gl-mat4/perspective';\nimport mat4_transpose from 'gl-mat4/transpose';\nimport mat4_invert from 'gl-mat4/invert';\nimport mat4_multiply from 'gl-mat4/multiply';\nimport mat4_rotate from 'gl-mat4/rotate';\nimport mat4_scale from 'gl-mat4/scale';\nimport mat4_translate from 'gl-mat4/translate';\nimport vec2_transformMat4 from 'gl-vec2/transformMat4';\nimport vec3_transformMat4 from 'gl-vec3/transformMat4';\nimport vec4_transformMat4 from 'gl-vec4/transformMat4';\n\nimport mat4_rotateX from 'gl-mat4/rotateX';\nimport mat4_rotateY from 'gl-mat4/rotateY';\nimport mat4_rotateZ from 'gl-mat4/rotateZ';\n\nconst IDENTITY = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n\nexport function validateMatrix4(m) {\n  return (\n    m.length === 16 &&\n    Number.isFinite(m[0]) &&\n    Number.isFinite(m[1]) &&\n    Number.isFinite(m[2]) &&\n    Number.isFinite(m[3]) &&\n    Number.isFinite(m[4]) &&\n    Number.isFinite(m[5]) &&\n    Number.isFinite(m[6]) &&\n    Number.isFinite(m[7]) &&\n    Number.isFinite(m[8]) &&\n    Number.isFinite(m[9]) &&\n    Number.isFinite(m[10]) &&\n    Number.isFinite(m[11]) &&\n    Number.isFinite(m[12]) &&\n    Number.isFinite(m[13]) &&\n    Number.isFinite(m[14]) &&\n    Number.isFinite(m[15])\n  );\n}\n\nfunction validateVector(v, length) {\n  if (v.length !== length) {\n    return false;\n  }\n  return v.every(Number.isFinite);\n}\n\nexport default class Matrix4 extends MathArray {\n  constructor(...args) {\n    super();\n    if (Array.isArray(args[0]) && arguments.length === 1) {\n      this.copy(args[0]);\n    } else {\n      this.identity();\n    }\n  }\n\n  get ELEMENTS() {\n    return 16;\n  }\n\n  /* eslint-disable max-params */\n  // accepts row major order, stores as column major\n  setRowMajor(\n    m00 = 1, m01 = 0, m02 = 0, m03 = 0,\n    m10 = 0, m11 = 1, m12 = 0, m13 = 0,\n    m20 = 0, m21 = 0, m22 = 1, m23 = 0,\n    m30 = 0, m31 = 0, m32 = 0, m33 = 1\n  ) {\n    this[0] = m00;\n    this[1] = m10;\n    this[2] = m20;\n    this[3] = m30;\n    this[4] = m01;\n    this[5] = m11;\n    this[6] = m21;\n    this[7] = m31;\n    this[8] = m02;\n    this[9] = m12;\n    this[10] = m22;\n    this[11] = m32;\n    this[12] = m03;\n    this[13] = m13;\n    this[14] = m23;\n    this[15] = m33;\n    return this.check();\n  }\n\n  // accepts column major order, stores in column major order\n  setColumnMajor(\n    m00 = 1, m10 = 0, m20 = 0, m30 = 0,\n    m01 = 0, m11 = 1, m21 = 0, m31 = 0,\n    m02 = 0, m12 = 0, m22 = 1, m32 = 0,\n    m03 = 0, m13 = 0, m23 = 0, m33 = 1\n  ) {\n    this[0] = m00;\n    this[1] = m10;\n    this[2] = m20;\n    this[3] = m30;\n    this[4] = m01;\n    this[5] = m11;\n    this[6] = m21;\n    this[7] = m31;\n    this[8] = m02;\n    this[9] = m12;\n    this[10] = m22;\n    this[11] = m32;\n    this[12] = m03;\n    this[13] = m13;\n    this[14] = m23;\n    this[15] = m33;\n    return this.check();\n  }\n  /* eslint-enable no-multi-spaces, brace-style, no-return-assign */\n\n  copy(array) {\n    return this.setColumnMajor(...array);\n  }\n\n  // Sets exact values (column major)\n  set(...args) {\n    return this.setColumnMajor(...args);\n  }\n\n  // By default assumes row major indices\n  getElement(i, j, columnMajor = false) {\n    return columnMajor ? this[i][j] : this[j][i];\n  }\n\n  // By default assumes row major indices\n  setElement(i, j, value, columnMajor = false) {\n    if (columnMajor) {\n      this[j][i] = checkNumber(value);\n    } else {\n      this[j][i] = checkNumber(value);\n    }\n    return this;\n  }\n\n  /* eslint-enable max-params */\n\n  // toString() {\n  //   if (config.printRowMajor) {\n  //     mat4_str(this);\n  //   } else {\n  //     mat4_str(this);\n  //   }\n  // }\n\n  // Accessors\n\n  determinant() {\n    return mat4_determinant(this);\n  }\n\n  // Constructors\n\n  identity() {\n    return this.copy(IDENTITY);\n  }\n\n  // Calculates a 4x4 matrix from the given quaternion\n  // q quat  Quaternion to create matrix from\n  fromQuaternion(q) {\n    mat4_fromQuat(this, q);\n    return this.check();\n  }\n\n  // Generates a frustum matrix with the given bounds\n  // left  Number  Left bound of the frustum\n  // right Number  Right bound of the frustum\n  // bottom  Number  Bottom bound of the frustum\n  // top Number  Top bound of the frustum\n  // near  Number  Near bound of the frustum\n  // far Number  Far bound of the frustum\n  frustum({left, right, bottom, top, near, far}) {\n    mat4_frustum(this, left, right, bottom, top, near, far);\n    return this.check();\n  }\n\n  // Generates a look-at matrix with the given eye position, focal point,\n  // and up axis\n  // eye vec3  Position of the viewer\n  // center  vec3  Point the viewer is looking at\n  // up  vec3  vec3 pointing up\n  lookAt({eye, center = [0, 0, 0], up = [0, 1, 0]}) {\n    mat4_lookAt(this, eye, center, up);\n    return this.check();\n  }\n\n  // Generates a orthogonal projection matrix with the given bounds\n  // from \"traditional\" view space parameters\n  // left  number  Left bound of the frustum\n  // right number  Right bound of the frustum\n  // bottom  number  Bottom bound of the frustum\n  // top number  Top bound of the frustum\n  // near  number  Near bound of the frustum\n  // far number  Far bound of the frustum\n  ortho({left, right, bottom, top, near = 0.1, far = 500}) {\n    mat4_ortho(this, left, right, bottom, top, near, far);\n    return this.check();\n  }\n\n  // Generates an orthogonal projection matrix with the same parameters\n  // as a perspective matrix (plus focalDistance)\n  // fovy  number  Vertical field of view in radians\n  // aspect  number  Aspect ratio. typically viewport width/height\n  // focalDistance distance in the view frustum used for extent calculations\n  // near  number  Near bound of the frustum\n  // far number  Far bound of the frustum\n  orthographic({fovy = 45 * Math.PI / 180, aspect = 1, focalDistance = 1, near = 0.1, far = 500}) {\n    if (fovy > Math.PI * 2) {\n      throw Error('radians');\n    }\n    const halfY = fovy / 2;\n    const top = focalDistance * Math.tan(halfY); // focus_plane is the distance from the camera\n    const right = top * aspect;\n\n    return new Matrix4().ortho({\n      left: -right,\n      right,\n      bottom: -top,\n      top,\n      near,\n      far\n    });\n  }\n\n  // Generates a perspective projection matrix with the given bounds\n  // fovy  number  Vertical field of view in radians\n  // aspect  number  Aspect ratio. typically viewport width/height\n  // near  number  Near bound of the frustum\n  // far number  Far bound of the frustum\n  perspective({\n    fovy,\n    fov = 45 * Math.PI / 180, // DEPRECATED\n    aspect = 1,\n    near = 0.1,\n    far = 500\n  } = {}) {\n    fovy = fovy || fov;\n    if (fovy > Math.PI * 2) {\n      throw Error('radians');\n    }\n    mat4_perspective(this, fovy, aspect, near, far);\n    return this.check();\n  }\n\n  // Modifiers\n\n  transpose() {\n    mat4_transpose(this, this);\n    return this.check();\n  }\n\n  invert() {\n    mat4_invert(this, this);\n    return this.check();\n  }\n\n  // Operations\n\n  multiplyLeft(a) {\n    mat4_multiply(this, a, this);\n    return this.check();\n  }\n\n  multiplyRight(a) {\n    mat4_multiply(this, this, a);\n    return this.check();\n  }\n\n  // Rotates a matrix by the given angle around the X axis\n  rotateX(radians) {\n    mat4_rotateX(this, this, radians);\n    // mat4_rotate(this, this, radians, [1, 0, 0]);\n    return this.check();\n  }\n\n  // Rotates a matrix by the given angle around the Y axis.\n  rotateY(radians) {\n    mat4_rotateY(this, this, radians);\n    // mat4_rotate(this, this, radians, [0, 1, 0]);\n    return this.check();\n  }\n\n  // Rotates a matrix by the given angle around the Z axis.\n  rotateZ(radians) {\n    mat4_rotateZ(this, this, radians);\n    // mat4_rotate(this, this, radians, [0, 0, 1]);\n    return this.check();\n  }\n\n  rotateXYZ([rx, ry, rz]) {\n    return this.rotateX(rx)\n      .rotateY(ry)\n      .rotateZ(rz);\n  }\n\n  rotateAxis(radians, axis) {\n    mat4_rotate(this, this, radians, axis);\n    return this.check();\n  }\n\n  scale(vec) {\n    mat4_scale(this, this, vec);\n    return this.check();\n  }\n\n  translate(vec) {\n    mat4_translate(this, this, vec);\n    return this.check();\n  }\n\n  transformVector2(vector, out) {\n    // out = out || [0, 0];\n    out = out || new Vector2();\n    vec2_transformMat4(out, vector, this);\n    validateVector(out, 2);\n    return out;\n  }\n\n  transformVector3(vector, out) {\n    // out = out || [0, 0, 0];\n    out = out || new Vector3();\n    vec3_transformMat4(out, vector, this);\n    validateVector(out, 3);\n    return out;\n  }\n\n  transformVector4(vector, out) {\n    // out = out || [0, 0, 0, 0];\n    out = out || new Vector4();\n    vec4_transformMat4(out, vector, this);\n    validateVector(out, 4);\n    return out.check();\n  }\n\n  // Transforms any 2, 3 or 4 element vector\n  // returns a newly minted Vector2, Vector3 or Vector4\n  transformVector(vector, out) {\n    switch (vector.length) {\n      case 2:\n        return this.transformVector2(vector, out);\n      case 3:\n        return this.transformVector3(vector, out);\n      case 4:\n        return this.transformVector4(vector, out);\n      default:\n        throw new Error('Illegal vector');\n    }\n  }\n\n  transformDirection(vector, out) {\n    return this._transformVector(vector, out, 0);\n  }\n\n  transformPoint(vector, out) {\n    return this._transformVector(vector, out, 1);\n  }\n\n  _transformVector(vector, out, w) {\n    switch (vector.length) {\n      case 2:\n        out = out || new Vector2();\n        // out = out || [0, 0];\n        vec4_transformMat4(out, [vector[0], vector[1], 0, w], this);\n        out.length = 2;\n        validateVector(out, 2);\n        break;\n      case 3:\n        out = out || new Vector3();\n        // out = out || [0, 0, 0];\n        vec4_transformMat4(out, [vector[0], vector[1], vector[2], w], this);\n        out.length = 3;\n        validateVector(out, 3);\n        break;\n      case 4:\n        if (Boolean(w) !== Boolean(vector[3])) {\n          throw new Error('math.gl: Matrix4.transformPoint - invalid vector')\n        }\n        out = out || new Vector4();\n        // out = out || [0, 0, 0, 0];\n        vec4_transformMat4(out, vector, this);\n        validateVector(out, 4);\n        break;\n      default:\n        throw new Error('Illegal vector');\n    }\n    return out;\n  }\n\n  // three.js compatibility\n  makeRotationX(radians) {\n    return this.identity().rotateX(radians);\n  }\n\n  makeTranslation(x, y, z) {\n    return this.identity().translate([x, y, z]);\n  }\n}\n"],"file":"matrix4.js"}