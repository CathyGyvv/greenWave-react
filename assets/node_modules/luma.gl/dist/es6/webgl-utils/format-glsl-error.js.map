{"version":3,"sources":["../../../src/webgl-utils/format-glsl-error.js"],"names":["getShaderName","getShaderTypeName","parseGLSLCompilerError","errLog","src","shaderType","errorStrings","split","errors","warnings","name","shaderName","i","length","errorString","segments","type","line","parseInt","isNaN","Error","lines","addLineNumbers","formatErrors","formatGLSLCompilerError","message","error","column","err","substring","join","trim","padLeft","string","start","delim","maxDigits","String","map","lineNumber","digits","prefix","result"],"mappings":"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","sourcesContent":["// TODO - formatGLSLCompilerError should not depend on this\nimport getShaderName, {getShaderTypeName} from './get-shader-name';\n\n/**\n * Parse a GLSL compiler error log into a string showing the source code around each error.\n * Based on https://github.com/wwwtyro/gl-format-compiler-error (public domain)\n */\n/* eslint-disable no-continue, max-statements */\nexport function parseGLSLCompilerError(errLog, src, shaderType) {\n  const errorStrings = errLog.split(/\\r?\\n/);\n  const errors = {};\n  const warnings = {};\n\n  const name = getShaderName(src) || '(unnamed)';\n  const shaderName = `${getShaderTypeName(shaderType)} shader ${name}`;\n\n  // Parse the error - note: browser and driver dependent\n  for (let i = 0; i < errorStrings.length; i++) {\n    const errorString = errorStrings[i];\n    if (errorString.length <= 1) {\n      continue;\n    }\n    const segments = errorString.split(':');\n    const type = segments[0];\n    const line = parseInt(segments[2], 10);\n    if (isNaN(line)) {\n      throw new Error(`GLSL compilation error in ${shaderName}: ${errLog}`);\n    }\n    if (type !== 'WARNING') {\n      errors[line] = errorString;\n    } else {\n      warnings[line] = errorString;\n    }\n  }\n\n  // Format the error inline with the code\n  const lines = addLineNumbers(src);\n\n  return {\n    shaderName,\n    errors: formatErrors(errors, lines),\n    warnings: formatErrors(warnings, lines)\n  };\n}\n\n// Formats GLSL compiler error log into single string\nexport default function formatGLSLCompilerError(errLog, src, shaderType) {\n  const {shaderName, errors, warnings} = parseGLSLCompilerError(errLog, src, shaderType);\n  return `GLSL compilation error in ${shaderName}\\n\\n${errors}\\n${warnings}`;\n}\n\n// helper function, outputs annotated errors or warnings\nfunction formatErrors(errors, lines) {\n  let message = '';\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    if (!errors[i + 3] && !errors[i + 2] && !errors[i + 1]) {\n      continue;\n    }\n    message += `${line}\\n`;\n    if (errors[i + 1]) {\n      const error = errors[i + 1];\n      const segments = error.split(':', 3);\n      const type = segments[0];\n      const column = parseInt(segments[1], 10) || 0;\n      const err = error.substring(segments.join(':').length + 1).trim();\n      message += padLeft(`^^^ ${type}: ${err}\\n\\n`, column);\n    }\n  }\n  return message;\n}\n\n/**\n * Prepends line numbers to each line of a string.\n * The line numbers will be left-padded with spaces to ensure an\n * aligned layout when rendered using monospace fonts.\n * @param {String} string - multi-line string to add line numbers to\n * @param {Number} start=1 - number of spaces to add\n * @param {String} delim =': ' - injected between line number and original line\n * @return {String[]} strings - array of string, one per line, with line numbers added\n */\nfunction addLineNumbers(string, start = 1, delim = ': ') {\n  const lines = string.split(/\\r?\\n/);\n  const maxDigits = String(lines.length + start - 1).length;\n  return lines.map((line, i) => {\n    const lineNumber = i + start;\n    const digits = String(lineNumber).length;\n    const prefix = padLeft(lineNumber, maxDigits - digits);\n    return prefix + delim + line;\n  });\n}\n\n/**\n * Pads a string with a number of spaces (space characters) to the left\n * @param {String} string - string to pad\n * @param {Number} digits - number of spaces to add\n * @return {String} string - The padded string\n */\nfunction padLeft(string, digits) {\n  let result = '';\n  for (let i = 0; i < digits; ++i) {\n    result += ' ';\n  }\n  return `${result}${string}`;\n}\n"],"file":"format-glsl-error.js"}