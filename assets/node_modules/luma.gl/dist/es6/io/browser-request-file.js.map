{"version":3,"sources":["../../../src/io/browser-request-file.js"],"names":["noop","XHR_STATES","UNINITIALIZED","LOADING","LOADED","INTERACTIVE","COMPLETED","XHR","constructor","url","path","method","asynchronous","noCache","sendAsBinary","responseType","onProgress","onError","onAbort","onComplete","join","async","req","XMLHttpRequest","onload","e","onerror","onabort","onprogress","lengthComputable","Math","round","loaded","total","setRequestHeader","header","value","sendAsync","body","Promise","resolve","reject","indexOf","Date","now","open","onreadystatechange","readyState","status","response","responseText","Error","send","error","requestFile","opts","xhr"],"mappings":"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","sourcesContent":["// Supports loading (requesting) assets with XHR (XmlHttpRequest)\n/* eslint-disable guard-for-in, complexity, no-try-catch */\n\n/* global XMLHttpRequest */\nfunction noop() {}\n\nconst XHR_STATES = {\n  UNINITIALIZED: 0,\n  LOADING: 1,\n  LOADED: 2,\n  INTERACTIVE: 3,\n  COMPLETED: 4\n};\n\nclass XHR {\n  constructor({\n    url,\n    path = null,\n    method = 'GET',\n    asynchronous = true,\n    noCache = false,\n    // body = null,\n    sendAsBinary = false,\n    responseType = false,\n    onProgress = noop,\n    onError = noop,\n    onAbort = noop,\n    onComplete = noop\n  }) {\n    this.url = path ? path.join(path, url) : url;\n    this.method = method;\n    this.async = asynchronous;\n    this.noCache = noCache;\n    this.sendAsBinary = sendAsBinary;\n    this.responseType = responseType;\n\n    this.req = new XMLHttpRequest();\n\n    this.req.onload = e => onComplete(e);\n    this.req.onerror = e => onError(e);\n    this.req.onabort = e => onAbort(e);\n    this.req.onprogress = e => {\n      if (e.lengthComputable) {\n        onProgress(e, Math.round(e.loaded / e.total * 100));\n      } else {\n        onProgress(e, -1);\n      }\n    };\n  }\n\n  setRequestHeader(header, value) {\n    this.req.setRequestHeader(header, value);\n    return this;\n  }\n\n  // /* eslint-disable max-statements */\n  sendAsync(body = this.body || null) {\n    return new Promise((resolve, reject) => {\n      try {\n        const {req, method, noCache, sendAsBinary, responseType} = this;\n\n        const url = noCache ?\n          this.url + (this.url.indexOf('?') >= 0 ? '&' : '?') + Date.now() :\n          this.url;\n\n        req.open(method, url, this.async);\n\n        if (responseType) {\n          req.responseType = responseType;\n        }\n\n        if (this.async) {\n          req.onreadystatechange = e => {\n            if (req.readyState === XHR_STATES.COMPLETED) {\n              if (req.status === 200) {\n                resolve(req.responseType ? req.response : req.responseText);\n              } else {\n                reject(new Error(`${req.status}: ${url}`));\n              }\n            }\n          };\n        }\n\n        if (sendAsBinary) {\n          req.sendAsBinary(body);\n        } else {\n          req.send(body);\n        }\n\n        if (!this.async) {\n          if (req.status === 200) {\n            resolve(req.responseType ? req.response : req.responseText);\n          } else {\n            reject(new Error(`${req.status}: ${url}`));\n          }\n        }\n      } catch (error) {\n        reject(error);\n      }\n    });\n  }\n  /* eslint-enable max-statements */\n}\n\nexport function requestFile(opts) {\n  const xhr = new XHR(opts);\n  return xhr.sendAsync();\n}\n"],"file":"browser-request-file.js"}