{"version":3,"sources":["../../../src/geometry/plane-geometry.js"],"names":["Geometry","uid","PlaneGeometry","constructor","opts","type","offset","flipCull","unpack","id","coords","split","c1len","c2len","subdivisions1","subdivisions2","numVertices","positions","Float32Array","normals","texCoords","i2","i3","z","x","u","v","numVertsAcross","indices","Uint16Array","index","positions2","length","normals2","texCoords2","undefined","attributes","Object","assign"],"mappings":"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","sourcesContent":["import Geometry from './geometry';\nimport {uid} from '../utils';\n\nexport default class PlaneGeometry extends Geometry {\n\n  // Primitives inspired by TDL http://code.google.com/p/webglsamples/,\n  // copyright 2011 Google Inc. new BSD License\n  // (http://www.opensource.org/licenses/bsd-license.php).\n  /* eslint-disable max-statements, complexity */\n  /* eslint-disable complexity, max-statements */\n  constructor(opts = {}) {\n    const {\n      type = 'x,y',\n      offset = 0,\n      flipCull = false,\n      unpack = false,\n      id = uid('plane-geometry')\n    } = opts;\n\n    const coords = type.split(',');\n    // width, height\n    let c1len = opts[`${coords[0]}len`];\n    const c2len = opts[`${coords[1]}len`];\n    // subdivisionsWidth, subdivisionsDepth\n    const subdivisions1 = opts[`n${coords[0]}`] || 1;\n    const subdivisions2 = opts[`n${coords[1]}`] || 1;\n    const numVertices = (subdivisions1 + 1) * (subdivisions2 + 1);\n\n    let positions = new Float32Array(numVertices * 3);\n    let normals = new Float32Array(numVertices * 3);\n    let texCoords = new Float32Array(numVertices * 2);\n\n    if (flipCull) {\n      c1len = -c1len;\n    }\n\n    let i2 = 0;\n    let i3 = 0;\n    for (let z = 0; z <= subdivisions2; z++) {\n      for (let x = 0; x <= subdivisions1; x++) {\n        const u = x / subdivisions1;\n        const v = z / subdivisions2;\n        texCoords[i2 + 0] = flipCull ? 1 - u : u;\n        texCoords[i2 + 1] = v;\n\n        switch (type) {\n        case 'x,y':\n          positions[i3 + 0] = c1len * u - c1len * 0.5;\n          positions[i3 + 1] = c2len * v - c2len * 0.5;\n          positions[i3 + 2] = offset;\n\n          normals[i3 + 0] = 0;\n          normals[i3 + 1] = 0;\n          normals[i3 + 2] = flipCull ? 1 : -1;\n          break;\n\n        case 'x,z':\n          positions[i3 + 0] = c1len * u - c1len * 0.5;\n          positions[i3 + 1] = offset;\n          positions[i3 + 2] = c2len * v - c2len * 0.5;\n\n          normals[i3 + 0] = 0;\n          normals[i3 + 1] = flipCull ? 1 : -1;\n          normals[i3 + 2] = 0;\n          break;\n\n        case 'y,z':\n          positions[i3 + 0] = offset;\n          positions[i3 + 1] = c1len * u - c1len * 0.5;\n          positions[i3 + 2] = c2len * v - c2len * 0.5;\n\n          normals[i3 + 0] = flipCull ? 1 : -1;\n          normals[i3 + 1] = 0;\n          normals[i3 + 2] = 0;\n          break;\n\n        default:\n          break;\n        }\n\n        i2 += 2;\n        i3 += 3;\n      }\n    }\n\n    const numVertsAcross = subdivisions1 + 1;\n    let indices = new Uint16Array(subdivisions1 * subdivisions2 * 6);\n\n    for (let z = 0; z < subdivisions2; z++) {\n      for (let x = 0; x < subdivisions1; x++) {\n        const index = (z * subdivisions1 + x) * 6;\n        // Make triangle 1 of quad.\n        indices[index + 0] = (z + 0) * numVertsAcross + x;\n        indices[index + 1] = (z + 1) * numVertsAcross + x;\n        indices[index + 2] = (z + 0) * numVertsAcross + x + 1;\n\n        // Make triangle 2 of quad.\n        indices[index + 3] = (z + 1) * numVertsAcross + x;\n        indices[index + 4] = (z + 1) * numVertsAcross + x + 1;\n        indices[index + 5] = (z + 0) * numVertsAcross + x + 1;\n      }\n    }\n\n    // Optionally, unpack indexed geometry\n    if (unpack) {\n      const positions2 = new Float32Array(indices.length * 3);\n      const normals2 = new Float32Array(indices.length * 3);\n      const texCoords2 = new Float32Array(indices.length * 2);\n\n      for (let x = 0; x < indices.length; ++x) {\n        const index = indices[x];\n        positions2[x * 3 + 0] = positions[index * 3 + 0];\n        positions2[x * 3 + 1] = positions[index * 3 + 1];\n        positions2[x * 3 + 2] = positions[index * 3 + 2];\n        normals2[x * 3 + 0] = normals[index * 3 + 0];\n        normals2[x * 3 + 1] = normals[index * 3 + 1];\n        normals2[x * 3 + 2] = normals[index * 3 + 2];\n        texCoords2[x * 2 + 0] = texCoords[index * 2 + 0];\n        texCoords2[x * 2 + 1] = texCoords[index * 2 + 1];\n      }\n\n      positions = positions2;\n      normals = normals2;\n      texCoords = texCoords2;\n      indices = undefined;\n    }\n\n    const attributes = {\n      positions,\n      normals,\n      texCoords\n    };\n\n    if (indices) {\n      attributes.indices = indices;\n    }\n\n    super(Object.assign({}, opts, {attributes, id}));\n  }\n}\n"],"file":"plane-geometry.js"}