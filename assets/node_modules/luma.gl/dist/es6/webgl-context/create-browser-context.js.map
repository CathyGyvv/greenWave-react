{"version":3,"sources":["../../../src/webgl-context/create-browser-context.js"],"names":["assert","createBrowserContext","canvas","opts","onError","message","onContextCreationError","error","statusMessage","addEventListener","webgl1","webgl2","gl","getContext","removeEventListener","trackContextCreation","onContextCreate","onContextCreated","HTMLCanvasElement","prototype","getContextSpy","type","context","bind","call","WebGLRenderingContext"],"mappings":"AAAA;AACA,OAAOA,MAAP,MAAmB,iBAAnB;AACA;;AAEA;;;;;AAIA,OAAO,SAASC,oBAAT,CAA8B;AACnCC,QADmC;AAEnCC,SAAO,EAF4B;AAExB;AACXC,YAAUC,WAAW;AAHc,CAA9B,EAIJ;AACD;AACA,WAASC,sBAAT,CAAgCC,KAAhC,EAAuC;AACrCH,YAAS,kBAAiBG,MAAMC,aAAN,IAAuB,eAAgB,EAAjE;AACD;;AACDN,SAAOO,gBAAP,CAAwB,2BAAxB,EAAqDH,sBAArD,EAA6E,KAA7E;AALC,sBAOsCH,IAPtC,CAOMO,MAPN;AAAA,QAOMA,MAPN,4BAOe,IAPf;AAAA,uBAOsCP,IAPtC,CAOqBQ,MAPrB;AAAA,QAOqBA,MAPrB,6BAO8B,IAP9B;AAQD,MAAIC,KAAK,IAAT,CARC,CASD;;AACA,MAAID,MAAJ,EAAY;AACVC,SAAKA,MAAMV,OAAOW,UAAP,CAAkB,QAAlB,EAA4BV,IAA5B,CAAX;AACAS,SAAKA,MAAMV,OAAOW,UAAP,CAAkB,qBAAlB,EAAyCV,IAAzC,CAAX;AACD;;AACD,MAAIO,MAAJ,EAAY;AACVE,SAAKA,MAAMV,OAAOW,UAAP,CAAkB,OAAlB,EAA2BV,IAA3B,CAAX;AACAS,SAAKA,MAAMV,OAAOW,UAAP,CAAkB,oBAAlB,EAAwCV,IAAxC,CAAX;AACD;;AAEDD,SAAOY,mBAAP,CAA2B,2BAA3B,EAAwDR,sBAAxD,EAAgF,KAAhF;;AAEA,MAAI,CAACM,EAAL,EAAS;AACP,WAAOR,QAAS,oBAAmBO,UAAU,CAACD,MAAX,GAAoB,QAApB,GAA+B,OAAQ,UAAnE,CAAP;AACD;;AAED,SAAOE,EAAP;AACD;AAED;;;;;AAIA,OAAO,SAASG,oBAAT,CAA8B;AACnCC,oBAAkB,MAAM,IADW;AAEnCC,qBAAmB,MAAM,CAAE;AAFQ,CAA9B,EAGJ;AACDjB,SAAOgB,mBAAmBC,gBAA1B;;AACA,MAAI,OAAOC,iBAAP,KAA6B,WAAjC,EAA8C;AAC5C,UAAML,aAAaK,kBAAkBC,SAAlB,CAA4BN,UAA/C;;AACAK,sBAAkBC,SAAlB,CAA4BN,UAA5B,GAAyC,SAASO,aAAT,CAAuBC,IAAvB,EAA6BlB,IAA7B,EAAmC;AAC1E;AACA,UAAImB,OAAJ;;AACA,UAAID,SAAS,OAAb,EAAsB;AACpBC,kBAAUN,gBAAgB;AAACd,kBAAQ,IAAT;AAAemB,cAAf;AAAqBlB,cAArB;AAA2BU,sBAAYA,WAAWU,IAAX,CAAgB,IAAhB;AAAvC,SAAhB,CAAV;AACD,OALyE,CAM1E;;;AACAD,gBAAUA,WAAWT,WAAWW,IAAX,CAAgB,IAAhB,EAAsBH,IAAtB,EAA4BlB,IAA5B,CAArB,CAP0E,CAQ1E;;AACA,UAAImB,mBAAmBG,qBAAvB,EAA8C;AAC5CR,yBAAiB;AAACf,kBAAQ,IAAT;AAAeoB,iBAAf;AAAwBD,cAAxB;AAA8BlB;AAA9B,SAAjB;AACD;;AACD,aAAOmB,OAAP;AACD,KAbD;AAcD;AACF","sourcesContent":["// Create a WebGL context\nimport assert from '../utils/assert';\n/* global HTMLCanvasElement, WebGLRenderingContext */\n\n/**\n * Create a WebGL context for a canvas\n * Note calling this multiple time on the same canvas does return the same context\n */\nexport function createBrowserContext({\n  canvas,\n  opts = {}, // WebGLRenderingContext options\n  onError = message => null\n}) {\n  // See if we can extract any extra information about why context creation failed\n  function onContextCreationError(error) {\n    onError(`WebGL context: ${error.statusMessage || 'Unknown error'}`);\n  }\n  canvas.addEventListener('webglcontextcreationerror', onContextCreationError, false);\n\n  const {webgl1 = true, webgl2 = true} = opts;\n  let gl = null;\n  // Prefer webgl2 over webgl1, prefer conformant over experimental\n  if (webgl2) {\n    gl = gl || canvas.getContext('webgl2', opts);\n    gl = gl || canvas.getContext('experimental-webgl2', opts);\n  }\n  if (webgl1) {\n    gl = gl || canvas.getContext('webgl', opts);\n    gl = gl || canvas.getContext('experimental-webgl', opts);\n  }\n\n  canvas.removeEventListener('webglcontextcreationerror', onContextCreationError, false);\n\n  if (!gl) {\n    return onError(`Failed to create ${webgl2 && !webgl1 ? 'WebGL2' : 'WebGL'} context`);\n  }\n\n  return gl;\n}\n\n/**\n * Installs a spy on Canvas.getContext\n * calls the provided callback with the {context}\n */\nexport function trackContextCreation({\n  onContextCreate = () => null,\n  onContextCreated = () => {}\n}) {\n  assert(onContextCreate || onContextCreated);\n  if (typeof HTMLCanvasElement !== 'undefined') {\n    const getContext = HTMLCanvasElement.prototype.getContext;\n    HTMLCanvasElement.prototype.getContext = function getContextSpy(type, opts) {\n      // Let intercepter create context\n      let context;\n      if (type === 'webgl') {\n        context = onContextCreate({canvas: this, type, opts, getContext: getContext.bind(this)});\n      }\n      // If not, create context\n      context = context || getContext.call(this, type, opts);\n      // Report it created\n      if (context instanceof WebGLRenderingContext) {\n        onContextCreated({canvas: this, context, type, opts});\n      }\n      return context;\n    };\n  }\n}\n"],"file":"create-browser-context.js"}