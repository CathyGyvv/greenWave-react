{"version":3,"sources":["../../../src/webgl-context/get-parameter.js"],"names":["GL","isWebGL2","gl","GL_TEXTURE_BINDING_3D","TEXTURE_BINDING_3D","WEBGL_debug_renderer_info","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_texture_filter_anisotropic","WEBGL_LIMITS","ALIASED_LINE_WIDTH_RANGE","Float32Array","ALIASED_POINT_SIZE_RANGE","MAX_TEXTURE_SIZE","MAX_CUBE_MAP_TEXTURE_SIZE","MAX_TEXTURE_IMAGE_UNITS","MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_VERTEX_TEXTURE_IMAGE_UNITS","MAX_RENDERBUFFER_SIZE","MAX_VARYING_VECTORS","MAX_VERTEX_ATTRIBS","MAX_VERTEX_UNIFORM_VECTORS","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_VIEWPORT_DIMS","Int32Array","MAX_3D_TEXTURE_SIZE","MAX_ARRAY_TEXTURE_LAYERS","MAX_CLIENT_WAIT_TIMEOUT_WEBGL","MAX_COLOR_ATTACHMENTS","MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS","MAX_COMBINED_UNIFORM_BLOCKS","MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS","MAX_DRAW_BUFFERS","MAX_ELEMENT_INDEX","MAX_ELEMENTS_INDICES","MAX_ELEMENTS_VERTICES","MAX_FRAGMENT_INPUT_COMPONENTS","MAX_FRAGMENT_UNIFORM_BLOCKS","MAX_FRAGMENT_UNIFORM_COMPONENTS","MAX_SAMPLES","MAX_SERVER_WAIT_TIMEOUT","MAX_TEXTURE_LOD_BIAS","MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS","MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS","MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS","MAX_UNIFORM_BLOCK_SIZE","MAX_UNIFORM_BUFFER_BINDINGS","MAX_VARYING_COMPONENTS","MAX_VERTEX_OUTPUT_COMPONENTS","MAX_VERTEX_UNIFORM_BLOCKS","MAX_VERTEX_UNIFORM_COMPONENTS","MIN_PROGRAM_TEXEL_OFFSET","MAX_PROGRAM_TEXEL_OFFSET","UNIFORM_BUFFER_OFFSET_ALIGNMENT","getContextLimits","luma","limits","webgl1MinLimits","webgl2MinLimits","isWebgl2","parameter","limit","webgl1MinLimit","gl1","webgl2MinLimit","gl2","minLimit","limitNotAvailable","getExtension","extension","value","getParameter","originalFunc","pname","GL_UNMASKED_VENDOR_WEBGL","GL_UNMASKED_RENDERER_WEBGL","GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT","GL_FRAGMENT_SHADER_DERIVATIVE_HINT","GL_DONT_CARE","GL_GPU_DISJOINT_EXT","extensions","info","UNMASKED_VENDOR_WEBGL","VENDOR","UNMASKED_RENDERER_WEBGL","RENDERER","undefined","hasTimerQueries","ext","MAX_TEXTURE_MAX_ANISOTROPY_EXT"],"mappings":"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","sourcesContent":["// A major polyfill of \"gl.getParameter\"\n// Attempts to return sane values for all known WebGL2 and extension constants\n/* eslint-disable camelcase */\nimport GL from '../constants';\n\n// Return true if WebGL2 context\nfunction isWebGL2(gl) {\n  const GL_TEXTURE_BINDING_3D = 0x806A;\n  return gl && gl.TEXTURE_BINDING_3D === GL_TEXTURE_BINDING_3D;\n}\n\nconst WEBGL_debug_renderer_info = 'WEBGL_debug_renderer_info';\nconst EXT_disjoint_timer_query = 'EXT_disjoint_timer_query';\nconst EXT_disjoint_timer_query_webgl2 = 'EXT_disjoint_timer_query_webgl2';\nconst EXT_texture_filter_anisotropic = 'EXT_texture_filter_anisotropic';\n\nconst WEBGL_LIMITS = {\n  [GL.ALIASED_LINE_WIDTH_RANGE]: [new Float32Array([1, 1])],\n  [GL.ALIASED_POINT_SIZE_RANGE]: [new Float32Array([1, 1])],\n  [GL.MAX_TEXTURE_SIZE]: [64, 2048],\n  [GL.MAX_CUBE_MAP_TEXTURE_SIZE]: [16],\n  [GL.MAX_TEXTURE_IMAGE_UNITS]: [8],\n  [GL.MAX_COMBINED_TEXTURE_IMAGE_UNITS]: [8],\n  [GL.MAX_VERTEX_TEXTURE_IMAGE_UNITS]: [0],\n  [GL.MAX_RENDERBUFFER_SIZE]: [1],\n  [GL.MAX_VARYING_VECTORS]: [8],\n  [GL.MAX_VERTEX_ATTRIBS]: [8],\n  [GL.MAX_VERTEX_UNIFORM_VECTORS]: [128],\n  [GL.MAX_FRAGMENT_UNIFORM_VECTORS]: [16],\n  [GL.MAX_VIEWPORT_DIMS]: [new Int32Array([0, 0])],\n\n  // Extensions\n  // [GL.MAX_TEXTURE_MAX_ANISOTROPY_EXT]: [1]\n\n  // WebGL2 Limits\n  [GL.MAX_3D_TEXTURE_SIZE]: [0, 256],\n  [GL.MAX_ARRAY_TEXTURE_LAYERS]: [0, 256],\n  [GL.MAX_CLIENT_WAIT_TIMEOUT_WEBGL]: [0, 0],\n  [GL.MAX_COLOR_ATTACHMENTS]: [0, 4],\n  [GL.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS]: [0, 0],\n  [GL.MAX_COMBINED_UNIFORM_BLOCKS]: [0, 0],\n  [GL.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS]: [0, 0],\n  [GL.MAX_DRAW_BUFFERS]: [0, 4],\n  [GL.MAX_ELEMENT_INDEX]: [0, 0],\n  [GL.MAX_ELEMENTS_INDICES]: [0, 0],\n  [GL.MAX_ELEMENTS_VERTICES]: [0, 0],\n  [GL.MAX_FRAGMENT_INPUT_COMPONENTS]: [0, 0],\n  [GL.MAX_FRAGMENT_UNIFORM_BLOCKS]: [0, 0],\n  [GL.MAX_FRAGMENT_UNIFORM_COMPONENTS]: [0, 0],\n  [GL.MAX_SAMPLES]: [0, 0],\n  [GL.MAX_SERVER_WAIT_TIMEOUT]: [0, 0],\n  [GL.MAX_TEXTURE_LOD_BIAS]: [0, 0],\n  [GL.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS]: [0, 0],\n  [GL.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS]: [0, 0],\n  [GL.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS]: [0, 0],\n  [GL.MAX_UNIFORM_BLOCK_SIZE]: [0, 0],\n  [GL.MAX_UNIFORM_BUFFER_BINDINGS]: [0, 0],\n  [GL.MAX_VARYING_COMPONENTS]: [0, 0],\n  [GL.MAX_VERTEX_OUTPUT_COMPONENTS]: [0, 0],\n  [GL.MAX_VERTEX_UNIFORM_BLOCKS]: [0, 0],\n  [GL.MAX_VERTEX_UNIFORM_COMPONENTS]: [0, 0],\n  [GL.MIN_PROGRAM_TEXEL_OFFSET]: [0, -8],\n  [GL.MAX_PROGRAM_TEXEL_OFFSET]: [0, 7],\n  [GL.UNIFORM_BUFFER_OFFSET_ALIGNMENT]: [0, 0]\n};\n\n// const EXTENSION_SETTINGS = {\n//   [GL.MAX_TEXTURE_MAX_ANISOTROPY_EXT]: 'anisotropy'\n// };\n\nexport function getContextLimits(gl) {\n  gl.luma = gl.luma || {};\n\n  if (!gl.luma.limits) {\n    gl.luma.limits = {};\n    gl.luma.webgl1MinLimits = {};\n    gl.luma.webgl2MinLimits = {};\n\n    const isWebgl2 = isWebGL2(gl);\n\n    // WEBGL limits\n    for (const parameter in WEBGL_LIMITS) {\n      const limit = WEBGL_LIMITS[parameter];\n\n      const webgl1MinLimit = limit.gl1;\n      const webgl2MinLimit = 'gl2' in limit ? limit.gl2 : limit.gl1;\n      const minLimit = isWebgl2 ? webgl2MinLimit : webgl1MinLimit;\n\n      // Check if we can query for this limit\n      const limitNotAvailable =\n        ('gl2' in limit && !isWebgl2) ||\n        ('extension' in limit && !gl.getExtension(limit.extension));\n\n      const value = limitNotAvailable ? minLimit : gl.getParameter(parameter);\n      gl.luma.limits[parameter] = value;\n      gl.luma.webgl1MinLimits[parameter] = webgl1MinLimit;\n      gl.luma.webgl2MinLimits[parameter] = webgl2MinLimit;\n    }\n  }\n\n  return gl.luma.limits;\n}\n\nexport function getParameter(gl, originalFunc, pname) {\n  const GL_UNMASKED_VENDOR_WEBGL = 0x9245; // vendor string of the graphics driver.\n  const GL_UNMASKED_RENDERER_WEBGL = 0x9246; // renderer string of the graphics driver.\n\n  const GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT = 0x84FF;\n\n  const GL_FRAGMENT_SHADER_DERIVATIVE_HINT = 0x8B8B;\n  const GL_DONT_CARE = 0x1100;\n  const GL_GPU_DISJOINT_EXT = 0x8FBB;\n\n  const {extensions} = gl.luma;\n\n  const info = gl.getExtension(WEBGL_debug_renderer_info);\n\n  switch (pname) {\n  // EXTENSIONS SOMETIMES DO NOT USE THE OFFICIAL CONSTANTS.\n  case GL_UNMASKED_VENDOR_WEBGL:\n    return originalFunc((info && info.UNMASKED_VENDOR_WEBGL) || GL.VENDOR);\n  case GL_UNMASKED_RENDERER_WEBGL:\n    return originalFunc((info && info.UNMASKED_RENDERER_WEBGL) || GL.RENDERER);\n\n  case GL_FRAGMENT_SHADER_DERIVATIVE_HINT:\n    return !isWebGL2(gl) ? GL_DONT_CARE : undefined;\n\n  case GL_GPU_DISJOINT_EXT:\n    const hasTimerQueries =\n      !extensions[EXT_disjoint_timer_query] && !extensions[EXT_disjoint_timer_query_webgl2];\n    return hasTimerQueries ? 0 : undefined;\n\n  case GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT:\n    const ext = gl.luma.extensions[EXT_texture_filter_anisotropic];\n    pname = ext && ext.MAX_TEXTURE_MAX_ANISOTROPY_EXT;\n    return !pname ? 1.0 : undefined;\n\n  default:\n    return undefined;\n  }\n}\n"],"file":"get-parameter.js"}