{"version":3,"sources":["../../../../src/packages/events/add-events.js"],"names":["noop","KEYS","enter","up","down","left","right","esc","space","backspace","tab","delete","toO3D","n","_getPos","elem","bbox","getBoundingClientRect","x","y","top","get","e","win","window","event","getWheel","wheelDelta","detail","getKey","code","which","keyCode","key","keyOf","fKey","String","fromCharCode","toLowerCase","shift","shiftKey","control","ctrlKey","alt","altKey","meta","metaKey","isRightClick","button","getPos","doc","document","documentElement","body","touches","length","touchesPos","l","evt","i","push","pageX","clientX","scrollLeft","pageY","clientY","scrollTop","page","stop","stopPropagation","cancelBubble","preventDefault","returnValue","EventsProxy","constructor","domElem","opt","scene","pos","callbacks","size","width","offsetWidth","height","offsetHeight","attachEvents","disableContextMenu","oncontextmenu","enableMouse","forEach","action","addEventListener","eventInfo","type","getBoxObjectFor","mozInnerScreenX","enableTouch","enableKeyboard","getSize","relative","centerOrigin","cachePosition","ge","epos","origPos","wheel","Object","assign","cacheTarget","posArray","cache","getTarget","picking","pick","cacheSize","mouseup","moved","onRightClick","hovered","onClick","pressed","onDragEnd","onDragCancel","mouseout","rt","relatedTarget","parentNode","onMouseLeave","mouseover","mousemove","onDragMove","target","hash","onMouseEnter","onMouseMove","mousewheel","onMouseWheel","mousedown","onDragStart","touchstart","touched","touchedLastPosition","onTouchStart","touchmove","touchMoved","onTouchMove","touchend","onTouchEnd","isNaN","onTap","onTouchCancel","keydown","onKeyDown","keyup","onKeyUp","prototype","DEFAULT_OPTS","bind","Keys","keyMap","name","addEvents","domElement","match","fname","fn","f","apply","Array","slice","call","arguments","removeEvents"],"mappings":"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","sourcesContent":["// event.js\n// Handle keyboard/mouse/touch events in the Canvas\n// TODO - this will not work under node\n\n/* eslint-disable dot-notation, max-statements, no-loop-func */\n/* global window, document */\nfunction noop() {}\n\nconst KEYS = {\n  enter: 13,\n  up: 38,\n  down: 40,\n  left: 37,\n  right: 39,\n  esc: 27,\n  space: 32,\n  backspace: 8,\n  tab: 9,\n  delete: 46\n};\n\n// returns an O3D object or false otherwise.\nfunction toO3D(n) {\n  return n !== true ? n : false;\n}\n\n// Returns an element position\nfunction _getPos(elem) {\n  const bbox = elem.getBoundingClientRect();\n  return {\n    x: bbox.left,\n    y: bbox.top,\n    bbox\n  };\n}\n\n// event object wrapper\nexport function get(e, win) {\n  win = win || window;\n  return e || win.event;\n}\n\nexport function getWheel(e) {\n  return e.wheelDelta ? e.wheelDelta / 120 : -(e.detail || 0) / 3;\n}\n\nexport function getKey(e) {\n  const code = e.which || e.keyCode;\n  let key = keyOf(code);\n  // onkeydown\n  const fKey = code - 111;\n  if (fKey > 0 && fKey < 13) {\n    key = `f${fKey}`;\n  }\n  key = key || String.fromCharCode(code).toLowerCase();\n\n  return {\n    code,\n    key,\n    shift: e.shiftKey,\n    control: e.ctrlKey,\n    alt: e.altKey,\n    meta: e.metaKey\n  };\n}\n\nexport function isRightClick(e) {\n  return e.which === 3 || e.button === 2;\n}\n\nexport function getPos(e, win) {\n  // get mouse position\n  win = win || window;\n  e = e || win.event;\n  let doc = win.document;\n  doc = doc.documentElement || doc.body;\n  // TODO(nico): make touch event handling better\n  if (e.touches && e.touches.length) {\n    const touchesPos = [];\n    const l = e.touches.length;\n    let evt;\n    for (let i = 0; i < l; ++i) {\n      evt = e.touches[i];\n      touchesPos.push({\n        x: evt.pageX || (evt.clientX + doc.scrollLeft),\n        y: evt.pageY || (evt.clientY + doc.scrollTop)\n      });\n    }\n    return touchesPos;\n  }\n  const page = {\n    x: e.pageX || (e.clientX + doc.scrollLeft),\n    y: e.pageY || (e.clientY + doc.scrollTop)\n  };\n  return [page];\n}\n\nexport function stop(e) {\n  if (e.stopPropagation) {\n    e.stopPropagation();\n  }\n  e.cancelBubble = true;\n  if (e.preventDefault) {\n    e.preventDefault();\n  } else {\n    e.returnValue = false;\n  }\n}\n\nexport class EventsProxy {\n\n  constructor(domElem, opt) {\n    this.scene = opt.scene;\n    this.domElem = domElem;\n    this.pos = _getPos(domElem);\n    this.opt = this.callbacks = opt;\n\n    this.size = {\n      width: domElem.width || domElem.offsetWidth,\n      height: domElem.height || domElem.offsetHeight\n    };\n\n    this.attachEvents();\n  }\n\n  attachEvents() {\n    const domElem = this.domElem;\n    const opt = this.opt;\n\n    if (opt.disableContextMenu) {\n      domElem.oncontextmenu = () => false;\n    }\n\n    if (opt.enableMouse) {\n      ['mouseup', 'mousedown', 'mousemove', 'mouseover', 'mouseout']\n      .forEach(action => {\n        domElem.addEventListener(action, (e, win) => {\n          this[action](this.eventInfo(action, e, win));\n        }, false);\n      });\n\n      // \"well, this is embarrassing...\"\n      let type = '';\n      if (!document.getBoxObjectFor && window.mozInnerScreenX === null) {\n        type = 'mousewheel';\n      } else {\n        type = 'DOMMouseScroll';\n      }\n      domElem.addEventListener(type, (e, win) => {\n        this['mousewheel'](this.eventInfo('mousewheel', e, win));\n      }, false);\n    }\n\n    if (opt.enableTouch) {\n      ['touchstart', 'touchmove', 'touchend'].forEach(action => {\n        domElem.addEventListener(action, (e, win) => {\n          this[action](this.eventInfo(action, e, win));\n        }, false);\n      });\n    }\n\n    if (opt.enableKeyboard) {\n      ['keydown', 'keyup'].forEach(action => {\n        document.addEventListener(action, (e, win) => {\n          this[action](this.eventInfo(action, e, win));\n        }, false);\n      });\n    }\n  }\n\n  eventInfo(type, e, win) {\n    const domElem = this.domElem;\n    const scene = this.scene;\n    const opt = this.opt;\n    const size = this.getSize();\n    const relative = opt.relative;\n    const centerOrigin = opt.centerOrigin;\n    const pos = opt.cachePosition && this.pos || _getPos(domElem);\n    const ge = get(e, win);\n    const epos = getPos(e, win);\n    const origPos = {x: epos[0].x, y: epos[0].y};\n    const evt = {};\n    let x;\n    let y;\n\n    // get Position\n    for (let i = 0, l = epos.length; i < l; ++i) {\n      x = epos[i].x;\n      y = epos[i].y;\n      if (relative) {\n        x -= pos.x; y -= pos.y;\n        if (centerOrigin) {\n          x -= size.width / 2;\n          y -= size.height / 2;\n          // y axis now points to the top of the screen\n          y *= -1;\n        }\n      }\n      epos[i].x = x;\n      epos[i].y = y;\n    }\n\n    switch (type) {\n    case 'mousewheel':\n      evt.wheel = getWheel(ge);\n      break;\n    case 'keydown':\n    case 'keyup':\n      Object.assign(evt, getKey(ge));\n      break;\n    case 'mouseup':\n      evt.isRightClick = isRightClick(ge);\n      break;\n    default:\n      break;\n    }\n\n    let cacheTarget;\n\n    Object.assign(evt, {\n      x: epos[0].x,\n      y: epos[0].y,\n      posArray: epos,\n\n      cache: false,\n      // stop event propagation\n      stop() {\n        stop(ge);\n      },\n      // get the target element of the event\n      getTarget() {\n        if (cacheTarget) {\n          return cacheTarget;\n        }\n        return (cacheTarget = opt.picking &&\n          scene.pick(origPos.x - pos.x, origPos.y - pos.y) || true);\n      }\n    });\n    // wrap native event\n    evt.event = ge;\n\n    return evt;\n  }\n\n  getSize() {\n    if (this.cacheSize) {\n      return this.size;\n    }\n    const domElem = this.domElem;\n    return {\n      width: domElem.width || domElem.offsetWidth,\n      height: domElem.height || domElem.offsetHeight\n    };\n  }\n\n  mouseup(e) {\n    if (!this.moved) {\n      if (e.isRightClick) {\n        this.callbacks.onRightClick(e, this.hovered);\n      } else {\n        this.callbacks.onClick(e, toO3D(this.pressed));\n      }\n    }\n    if (this.pressed) {\n      if (this.moved) {\n        this.callbacks.onDragEnd(e, toO3D(this.pressed));\n      } else {\n        this.callbacks.onDragCancel(e, toO3D(this.pressed));\n      }\n      this.pressed = this.moved = false;\n    }\n  }\n\n  mouseout(e) {\n    // mouseout canvas\n    let rt = e.relatedTarget;\n    const domElem = this.domElem;\n    while (rt && rt.parentNode) {\n      if (domElem === rt.parentNode) {\n        return;\n      }\n      rt = rt.parentNode;\n    }\n    if (this.hovered) {\n      this.callbacks.onMouseLeave(e, this.hovered);\n      this.hovered = false;\n    }\n    if (this.pressed && this.moved) {\n      this.callbacks.onDragEnd(e);\n      this.pressed = this.moved = false;\n    }\n  }\n\n  mouseover(e) {\n  }\n\n  mousemove(e) {\n    if (this.pressed) {\n      this.moved = true;\n      this.callbacks.onDragMove(e, toO3D(this.pressed));\n      return;\n    }\n    if (this.hovered) {\n      const target = toO3D(e.getTarget());\n      if (!target || target.hash !== this.hash) {\n        this.callbacks.onMouseLeave(e, this.hovered);\n        this.hovered = target;\n        this.hash = target;\n        if (target) {\n          this.hash = target.hash;\n          this.callbacks.onMouseEnter(e, this.hovered);\n        }\n      } else {\n        this.callbacks.onMouseMove(e, this.hovered);\n      }\n    } else {\n      this.hovered = toO3D(e.getTarget());\n      this.hash = this.hovered;\n      if (this.hovered) {\n        this.hash = this.hovered.hash;\n        this.callbacks.onMouseEnter(e, this.hovered);\n      }\n    }\n    if (!this.opt.picking) {\n      this.callbacks.onMouseMove(e);\n    }\n  }\n\n  mousewheel(e) {\n    this.callbacks.onMouseWheel(e);\n  }\n\n  mousedown(e) {\n    this.pressed = e.getTarget();\n    this.callbacks.onDragStart(e, toO3D(this.pressed));\n  }\n\n  touchstart(e) {\n    this.touched = e.getTarget();\n    this.touchedLastPosition = {x: e.x, y: e.y};\n    this.callbacks.onTouchStart(e, toO3D(this.touched));\n  }\n\n  touchmove(e) {\n    if (this.touched) {\n      this.touchMoved = true;\n      this.callbacks.onTouchMove(e, toO3D(this.touched));\n    }\n  }\n\n  touchend(e) {\n    if (this.touched) {\n      if (this.touchMoved) {\n        this.callbacks.onTouchEnd(e, toO3D(this.touched));\n      } else {\n        e.x = isNaN(e.x) ? this.touchedLastPosition.x : e.x;\n        e.y = isNaN(e.y) ? this.touchedLastPosition.y : e.y;\n        this.callbacks.onTap(e, toO3D(this.touched));\n        this.callbacks.onTouchCancel(e, toO3D(this.touched));\n      }\n      this.touched = this.touchMoved = false;\n    }\n  }\n\n  keydown(e) {\n    this.callbacks.onKeyDown(e);\n  }\n\n  keyup(e) {\n    this.callbacks.onKeyUp(e);\n  }\n}\n\nObject.assign(EventsProxy.prototype, {\n  hovered: false,\n  pressed: false,\n  touched: false,\n  touchedLastPosition: {x: 0, y: 0},\n  touchMoved: false,\n  moved: false\n});\n\nconst DEFAULT_OPTS = {\n  cachePosition: true,\n  cacheSize: true,\n  relative: true,\n  centerOrigin: true,\n  disableContextMenu: true,\n  bind: false,\n  picking: false,\n\n  enableTouch: true,\n  enableMouse: true,\n  enableKeyboard: true,\n\n  onClick: noop,\n  onRightClick: noop,\n  onDragStart: noop,\n  onDragMove: noop,\n  onDragEnd: noop,\n  onDragCancel: noop,\n  onTouchStart: noop,\n  onTouchMove: noop,\n  onTouchEnd: noop,\n  onTouchCancel: noop,\n  onTap: noop,\n  onMouseMove: noop,\n  onMouseEnter: noop,\n  onMouseLeave: noop,\n  onMouseWheel: noop,\n  onKeyDown: noop,\n  onKeyUp: noop\n};\n\nexport const Keys = KEYS;\n\nfunction keyOf(code) {\n  const keyMap = Keys;\n  for (const name in keyMap) {\n    if (keyMap[name] === code) {\n      return name;\n    }\n  }\n  return null;\n}\n\nexport function addEvents(domElement, opt = {}) {\n  opt = Object.assign({}, DEFAULT_OPTS, opt);\n\n  const bind = opt.bind;\n  if (bind) {\n    for (const name in opt) {\n      if (name.match(/^on[a-zA-Z0-9]+$/)) {\n        ((fname, fn) => {\n          opt[fname] = function f() {\n            fn.apply(bind, Array.prototype.slice.call(arguments));\n          };\n        })(name, opt[name]);\n      }\n    }\n  }\n\n  return new EventsProxy(domElement, opt);\n}\n\nexport function removeEvents(domElement, opt = {}) {\n  opt = Object.assign({}, DEFAULT_OPTS, opt);\n\n  const bind = opt.bind;\n  if (bind) {\n    for (const name in opt) {\n      if (name.match(/^on[a-zA-Z0-9]+$/)) {\n        ((fname, fn) => {\n          opt[fname] = function f() {\n            fn.apply(bind, Array.prototype.slice.call(arguments));\n          };\n        })(name, opt[name]);\n      }\n    }\n  }\n\n  return new EventsProxy(domElement, opt);\n}\n"],"file":"add-events.js"}