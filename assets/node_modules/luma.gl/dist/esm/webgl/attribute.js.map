{"version":3,"sources":["../../../src/webgl/attribute.js"],"names":["assert","Buffer","GL","Attribute","gl","opts","id","type","isIndexed","target","ELEMENT_ARRAY_BUFFER","ARRAY_BUFFER","value","externalBuffer","buffer","userData","update","Object","seal","_validateAttributeDefinition","delete","size","offset","stride","normalized","integer","instanced","isGeneric","isInstanced","undefined","setData","data"],"mappings":"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","sourcesContent":["/* eslint-disable complexity */\nimport assert from '../utils/assert';\nimport {Buffer} from '../webgl';\nimport GL from '../constants';\n\nexport default class Attribute {\n  constructor(gl, opts = {}) {\n    const {\n      id = 'unnamed-attribute',\n      type,\n      isIndexed = false\n    } = opts;\n\n    // Options that cannot be changed later\n    this.gl = gl;\n    this.id = id;\n    this.isIndexed = isIndexed;\n    this.target = isIndexed ? GL.ELEMENT_ARRAY_BUFFER : GL.ARRAY_BUFFER;\n    this.type = type;\n\n    // Initialize the attribute descriptor, with WebGL and metadata fields\n    this.value = null;\n    this.externalBuffer = null;\n    this.buffer = null;\n    this.userData = {}; // Reserved for application\n    this.update(opts);\n\n    // Sanity - no app fields on our attributes. Use userData instead.\n    Object.seal(this);\n\n    // Check all fields and generate helpful error messages\n    this._validateAttributeDefinition();\n  }\n\n  delete() {\n    if (this.buffer) {\n      this.buffer.delete();\n      this.buffer = null;\n    }\n  }\n\n  update({\n    value,\n    buffer,\n\n    // buffer options\n    size = this.size,\n    offset = this.offset || 0,\n    stride = this.stride || 0,\n    normalized = this.normalized || false,\n    integer = this.integer || false,\n    instanced = this.instanced || 0,\n\n    isGeneric = this.isGeneric || false,\n    isInstanced\n  }) {\n\n    this.size = size;\n    this.offset = offset;\n    this.stride = stride;\n    this.normalized = normalized;\n    this.integer = integer;\n    this.isGeneric = isGeneric;\n\n    if (isInstanced !== undefined) {\n      this.instanced = isInstanced ? 1 : 0;\n    } else {\n      this.instanced = instanced;\n    }\n\n    if (buffer) {\n      this.externalBuffer = buffer;\n      this.type = buffer.type;\n    } else if (value) {\n      this.externalBuffer = null;\n      this.value = value;\n\n      if (!isGeneric) {\n        // Create buffer if needed\n        this.buffer = this.buffer || new Buffer(this.gl, {\n          target: this.target,\n          type: this.type\n        });\n        this.buffer.setData({data: value});\n        this.type = this.buffer.type;\n      }\n    }\n  }\n\n  getBuffer() {\n    if (this.isGeneric) {\n      return null;\n    }\n    return this.externalBuffer || this.buffer;\n  }\n\n  _validateAttributeDefinition() {\n    assert(\n      this.size >= 1 && this.size <= 4,\n      `Attribute definition for ${this.id} invalid size`\n    );\n  }\n}\n"],"file":"attribute.js"}