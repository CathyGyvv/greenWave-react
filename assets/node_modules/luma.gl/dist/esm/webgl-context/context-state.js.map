{"version":3,"sources":["../../../src/webgl-context/context-state.js"],"names":["GL","pushContextState","popContextState","getParameter","getParameters","setParameter","setParameters","glSetParameters","resetParameters","getModifiedParameters","isObjectEmpty","assert","LUMA_SETTERS","framebuffer","gl","handle","bindFramebuffer","FRAMEBUFFER","blend","value","enable","BLEND","disable","blendColor","blendEquation","args","isArray","blendEquationSeparate","blendFunc","length","blendFuncSeparate","clearColor","clearDepth","clearStencil","colorMask","cull","CULL_FACE","cullFace","depthTest","DEPTH_TEST","depthFunc","depthMask","depthRange","dither","DITHER","derivativeHint","hint","FRAGMENT_SHADER_DERIVATIVE_HINT","frontFace","mipmapHint","GENERATE_MIPMAP_HINT","lineWidth","polygonOffsetFill","POLYGON_OFFSET_FILL","polygonOffset","sampleCoverage","scissorTest","SCISSOR_TEST","scissor","stencilTest","STENCIL_TEST","stencilMask","mask","backMask","stencilMaskSeparate","FRONT","BACK","stencilFunc","func","ref","backFunc","backRef","stencilFuncSeparate","stencilOp","sfail","dpfail","dppass","backSfail","backDpfail","backDppass","stencilOpSeparate","viewport","array","Array","ArrayBuffer","isView","parameters","key","setter","withParameters","nocatch","frameBuffer"],"mappings":"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","sourcesContent":["/* eslint-disable no-inline-comments, max-len */\nimport GL from '../constants';\nimport {\n  pushContextState,\n  popContextState\n} from '../webgl-context/track-context-state';\nimport {\n  getParameter,\n  getParameters,\n  setParameter,\n  setParameters as glSetParameters,\n  resetParameters,\n  getModifiedParameters\n} from '../webgl-context/set-parameters';\nimport {isObjectEmpty} from '../utils';\nimport assert from '../utils/assert';\n\n// map of parameter setter function names, parameter constants, default values and types\n// - Uses gl function names, except when setter function exist that are named differently\n// - When the WebGL api offers <setter> and <setter>Separate (e.g. blendEquation and\n//   blendEquationSeparate, we use non-separate name, but accept both non-separate and\n//   separate arguments. Thus, a `getParameter` call will always return all the separate values\n//   in an array, in a form that can be accepted by the setter.\nexport const LUMA_SETTERS = {\n  framebuffer: (gl, framebuffer) => {\n    const handle = framebuffer && framebuffer.handle ? framebuffer.handle : framebuffer;\n    return gl.bindFramebuffer(GL.FRAMEBUFFER, handle);\n  },\n  blend: (gl, value) => value ? gl.enable(GL.BLEND) : gl.disable(GL.BLEND),\n  blendColor: (gl, value) => gl.blendColor(...value),\n  blendEquation: (gl, args) => {\n    args = isArray(args) ? args : [args, args];\n    gl.blendEquationSeparate(...args);\n  },\n  blendFunc: (gl, args) => {\n    args = isArray(args) && args.length === 2 ? [...args, ...args] : args;\n    gl.blendFuncSeparate(...args);\n  },\n\n  clearColor: (gl, value) => gl.clearColor(...value),\n  clearDepth: (gl, value) => gl.clearDepth(value),\n  clearStencil: (gl, value) => gl.clearStencil(value),\n\n  colorMask: (gl, value) => gl.colorMask(...value),\n\n  cull: (gl, value) => value ? gl.enable(GL.CULL_FACE) : gl.disable(GL.CULL_FACE),\n  cullFace: (gl, value) => gl.cullFace(value),\n\n  depthTest: (gl, value) => value ? gl.enable(GL.DEPTH_TEST) : gl.disable(GL.DEPTH_TEST),\n  depthFunc: (gl, value) => gl.depthFunc(value),\n  depthMask: (gl, value) => gl.depthMask(value),\n  depthRange: (gl, value) => gl.depthRange(...value),\n\n  dither: (gl, value) => value ? gl.enable(GL.DITHER) : gl.disable(GL.DITHER),\n\n  derivativeHint: (gl, value) => {\n    // gl1: 'OES_standard_derivatives'\n    gl.hint(GL.FRAGMENT_SHADER_DERIVATIVE_HINT, value);\n  },\n\n  frontFace: (gl, value) => gl.frontFace(value),\n\n  mipmapHint: (gl, value) => gl.hint(GL.GENERATE_MIPMAP_HINT, value),\n\n  lineWidth: (gl, value) => gl.lineWidth(value),\n\n  polygonOffsetFill: (gl, value) =>\n    value ? gl.enable(GL.POLYGON_OFFSET_FILL) : gl.disable(GL.POLYGON_OFFSET_FILL),\n  polygonOffset: (gl, value) => gl.polygonOffset(...value),\n\n  sampleCoverage: (gl, value) => gl.sampleCoverage(...value),\n\n  scissorTest: (gl, value) => value ? gl.enable(GL.SCISSOR_TEST) : gl.disable(GL.SCISSOR_TEST),\n  scissor: (gl, value) => gl.scissor(...value),\n\n  stencilTest: (gl, value) => value ? gl.enable(GL.STENCIL_TEST) : gl.disable(GL.STENCIL_TEST),\n  stencilMask: (gl, value) => {\n    value = isArray(value) ? value : [value, value];\n    const [mask, backMask] = value;\n    gl.stencilMaskSeparate(GL.FRONT, mask);\n    gl.stencilMaskSeparate(GL.BACK, backMask);\n  },\n  stencilFunc: (gl, args) => {\n    args = isArray(args) && args.length === 3 ? [...args, ...args] : args;\n    const [func, ref, mask, backFunc, backRef, backMask] = args;\n    gl.stencilFuncSeparate(GL.FRONT, func, ref, mask);\n    gl.stencilFuncSeparate(GL.BACK, backFunc, backRef, backMask);\n  },\n  stencilOp: (gl, args) => {\n    args = isArray(args) && args.length === 3 ? [...args, ...args] : args;\n    const [sfail, dpfail, dppass, backSfail, backDpfail, backDppass] = args;\n    gl.stencilOpSeparate(GL.FRONT, sfail, dpfail, dppass);\n    gl.stencilOpSeparate(GL.BACK, backSfail, backDpfail, backDppass);\n  },\n\n  viewport: (gl, value) => gl.viewport(...value)\n};\n\n// HELPERS\n\nfunction isArray(array) {\n  return Array.isArray(array) || ArrayBuffer.isView(array);\n}\n\n// GETTERS AND SETTERS\n\n// Get the parameter value(s) from the context\nexport {getParameter}; // from '../webgl-utils/set-parameters'\n\n// Get the parameters from the context\nexport {getParameters}; // from '../webgl-utils/set-parameters'\n\n// Resets gl state to default values.\nexport {setParameter}; // from '../webgl-utils/set-parameters'\n\n// Resets gl state to default values.\nexport {resetParameters}; // from '../webgl-utils/set-parameters'\n\n// Get a map of modified parameters\nexport {getModifiedParameters};\n\n// Note: \"setParameters\" is given extra treatment below\n\n// Set the parameter value(s) by key to the context\n// Sets value with key to context.\n// Value may be \"normalized\" (in case a short form is supported). In that case\n// the normalized value is retured.\nexport function setParameters(gl, parameters) {\n  glSetParameters(gl, parameters);\n  for (const key in parameters) {\n    const setter = LUMA_SETTERS[key];\n    if (setter) {\n      setter(gl, parameters[key], key);\n    }\n  }\n}\n\n// VERY LIMITED / BASIC GL STATE MANAGEMENT\n// Executes a function with gl states temporarily set, exception safe\n// Currently support pixelStorage, scissor test and framebuffer binding\nexport function withParameters(gl, parameters, func) {\n  // assertWebGLContext(gl);\n\n  if (isObjectEmpty(parameters)) {\n    // Avoid setting state if no parameters provided. Just call and return\n    return func(gl);\n  }\n\n  const {nocatch = true} = parameters;\n  // frameBuffer not supported use framebuffer\n  assert(!parameters.frameBuffer);\n\n  pushContextState(gl);\n  setParameters(gl, parameters);\n\n  // Setup is done, call the function\n  let value;\n\n  if (nocatch) {\n    // Avoid try catch to minimize stack size impact for safe execution paths\n    value = func(gl);\n    popContextState(gl);\n  } else {\n    // Wrap in a try-catch to ensure that parameters are restored on exceptions\n    try {\n      value = func(gl);\n    } finally {\n      popContextState(gl);\n    }\n  }\n\n  return value;\n}\n"],"file":"context-state.js"}